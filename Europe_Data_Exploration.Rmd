---
title: "Europe Data Exploration"
author: "Greg Sanders"
date: "October 25, 2015"
output: 
  html_document: 
    fig_caption: yes
    keep_md: yes
    toc: yes
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Setup, echo = FALSE, results = "hide", warning=FALSE, message=FALSE}
#*************************************Required Libraries******************************************
require(plyr)
require(grid)
require(reshape2)
require(stringr)
require(ggplot2)
require(stringr)
#*************************************Options*****************************************************
options(error=recover)
options(warn=1)
#*************************************Lookup Files*****************************************************
# Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
# Path<-"~\\FPDS\\R scripts and data\\"
Path<-"C:\\Users\\Greg Sanders\\SkyDrive\\Documents\\R Scripts and Data SkyDrive\\"
# setwd("K:/Development/Europe") #Your working directory here!
# setwd("C:/Users/Greg Sanders/Documents/Development/Europe")
# setwd("C:/Users/scohen/My Documents/Europe/Git/Europe")
 
legend.text.size<-10
axis.text.size<-10
strip.text.size<-10
legend.text.size<-10

table.text.size<-11
title.text.size<-12
geom.text.size<-1.5

source("EuropeInput.R")

source(paste(Path,"helper.r",sep=""))
source(paste(Path,"lookups.r",sep=""))

EuropeSample<-read.csv("Data\\EuropeSample.csv", 
                                 header = TRUE) 
EuropeSample<-subset(EuropeSample, !Country %in% c("Greece", "Sweden","Russia","United States",
                                                       "Serbia", "Bulgaria", "Romania"))

Coloration<-read.csv(
    paste(Path,"Lookups\\","lookup_coloration.csv",sep=""),
    header=TRUE, sep=",", na.strings="", dec=".", strip.white=TRUE, 
    stringsAsFactors=FALSE
    )

Coloration<-ddply(Coloration
                  , c(.(R), .(G), .(B))
                  , transform
                  , ColorRGB=as.character(
                      if(min(is.na(c(R,G,B)))) {NA} 
                      else {rgb(max(R),max(G),max(B),max=255)}
                      )
                  )


EuropeSample$Cabinet<-"Cabinet"
EuropeSample$Opposition<-"Opposition"

EuropeDefOrEqu<-melt(EuropeSample,
                 measure.vars=c("DefSpendDelt","EquSpendDelt","DefSpendDelt_lead","EquSpendDelt_lead"),
                 variable.name="DefOrEqu",
                 value.name = "ExpenditureDelt")


EuropeLong<-melt(EuropeSample,
                     id.vars=c("Country","Year"),
                 measure.vars=c("DefSpendDelt","EquSpendDelt","DefSpendDelt_lead","EquSpendDelt_lead",
                                "DefSpread","DefSpread_lag1","DefSpread_lag2",
                                "EUldrSpread","EUldrSpread_lag1","EUldrSpread_lag2",
                                "NATOessSpread","NATOessSpread_lag1","NATOessSpread_lag2", 
                                "NATO.EUspread", "NATO.EUspread_lag1","NATO.EUspread_lag2",
                                "CivilWar", "IntlCnf", "IntAt", "DomAt","GDPpCap",
                                "Cab_left_right","Opp_left_right","left_right_ls_spread",
                                "Cab_liberty_authority","Opp_liberty_authority","liberty_authority_ls_spread",
                                "Cab_eu_anti_pro","Opp_eu_anti_pro","Opp_eu_anti_pro"),
                 variable.name="MetricName",
                 value.name = "MetricValue")

           
EuropeLong<-subset(EuropeLong,!is.na(MetricValue))

                                                           
                   

        
             
```

You can also embed plots, for example:

#Dependent Variables

```{r DependentVariables, echo=FALSE}

DefLine<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Change in Total Defense Spending",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=EuropeSample,
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="DefSpendDelt",
                             VAR.y.series="Country",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary=NA
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
DefLine+geom_line(color="black")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous(labels = percent_format())+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))
# +
#     geom_shape()
#     scale_shape_manual(name="Spending",
#                                                                 limits=c("DefSpread",
#                                                                          "DefSpendDelta"),
#                                                                 labels=c("Net Support for Defense Spending", 
#                                                                          "Change in Defense Spending"),
#                                                                 values=c(16,2))
# +
#     scale_line_manual(name="Spending",
#                                                                 limits=c("DefSpread",
#                                                                          "DefSpendDelta"),
#                                                                 labels=c("Net Support for Defense Spending", 
#                                                                          "Change in Defense Spending"),
#                                                                 values=c(16,2))

EquLine<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Change in Defense Equipment Spending",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=EuropeSample,
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="EquSpendDelt",
                             VAR.y.series="Country",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary=NA
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)

EquLine+geom_line(color="black")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous(labels = percent_format())+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))


ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=EquSpendDelt))+geom_point()

ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=DefSpread))+geom_point()

ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=EUldrSpread))+geom_point()
ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=DefSpread))+geom_point()


BothLine<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Expenditures, Annual Percent Change",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeDefOrEqu,DefOrEqu %in% c("DefSpendDelt","EquSpendDelt")),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="ExpenditureDelt",
                             VAR.y.series="Country",
                             VAR.facet.primary="DefOrEqu",
                             VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             # DataLabels=NA
                             #                       ,VAR.override.coloration=NA
)
BothLine

ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="Top-Line Defense Spending, Annual Percent Change (T=0)",
    VAR.Y.label="Top-Line Defense Spending, Annual Percent Change (T=-1)",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="DefSpendDelt",
    VAR.y.variable="DefSpendDelt_lead"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)


ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="Defense Equipment Spending, Annual Percent Change (T=0)",
    VAR.Y.label="Defense Equipment Spending, Annual Percent Change (T=1)",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="EquSpendDelt",
    VAR.y.variable="EquSpendDelt_lead"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)




```



```{r Polling}



DefTooMuchTooLittle.Def<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Percent",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeLong,MetricName %in% c("DefSpendDelt","DefSpread")),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="MetricValue",
                             VAR.y.series="MetricName",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
DefTooMuchTooLittle.Def+geom_point()+
    aes(shape=factor(category,levels=labels.category.DF$variable))+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=category),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c("DefSpread",
                                "DefSpendDelt"),
                       labels=c("Net Support for Defense Spending", 
                                "Change in Defense Spending"),
                       values=c(1,16))





DefTooMuchTooLittle.Equ<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Percent",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeLong,MetricName %in% c("EquSpendDelt","DefSpread")),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="MetricValue",
                             VAR.y.series="MetricName",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
DefTooMuchTooLittle.Equ+geom_point()+
    aes(shape=factor(category,levels=labels.category.DF$variable))+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=category),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c("DefSpread",
                                # "DefSpendDelt",
                                "EquSpendDelt"),
                       labels=c("Net Support for Defense Spending", 
                                # "Change in Defense Spending",
                                "Change in Equipment Spending"),
                       values=c(1,
                                # 16,
                                17))







EUleadership.Def<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Percent",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeLong,MetricName %in% c("DefSpendDelt","EUldrSpread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="MetricValue",
                             VAR.y.series="MetricName",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
EUleadership.Def+aes(shape=factor(category,levels=labels.category.DF$variable))+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=category),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                "EUldrSpread",
                                "DefSpendDelt"
                                # "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                "Net Desire for Strong EU Leadership",
                                "Change in Defense Spending"
                                # "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                4,
                                16
                                # 17
                                ))


EUleadership.Equ<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Percent",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeLong,MetricName %in% c("EquSpendDelt","EUldrSpread") &
                                                     Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="MetricValue",
                             VAR.y.series="MetricName",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
EUleadership.Equ+geom_point()+aes(shape=factor(category,levels=labels.category.DF$variable))+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=category),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                "EUldrSpread",
                                # "DefSpendDelt"
                                "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                "Net Desire for Strong EU Leadership",
                                # "Change in Defense Spending"
                                "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                4,
                                # 16
                                17
                                ))

 


NATOessen.Def<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Percent",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeLong,MetricName %in% c("DefSpendDelt","NATOessSpread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="MetricValue",
                             VAR.y.series="MetricName",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
NATOessen.Def+aes(shape=factor(category,levels=labels.category.DF$variable))+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=category),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                                "NATOessSpread",
                                "DefSpendDelt"
                                # "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                "Net Belief that NATO is Essential",
                                "Change in Defense Spending"
                                # "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                8,
                                16
                                # 17
                                ))





NATOessen.Equ<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Percent",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeLong,MetricName %in% c("EquSpendDelt","NATOessSpread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="MetricValue",
                             VAR.y.series="MetricName",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
NATOessen.Equ+aes(shape=factor(category,levels=labels.category.DF$variable))+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=category),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                           "NATOessSpread",
                                # "DefSpendDelt"
                                "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                "Net Belief that NATO is Essential",
                                # "Change in Defense Spending"
                                "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                8,
                                # 16
                                17
                                ))



NATO.EUconv.Def<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Percent",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeLong,MetricName %in% c("DefSpendDelt","NATO.EUspread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="MetricValue",
                             VAR.y.series="MetricName",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
NATO.EUconv.Def+aes(shape=factor(category,levels=labels.category.DF$variable))+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=category),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                                # "NATOessSpread",
                                "NATO.EUspread",
                                "DefSpendDelt"
                                # "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                # "Net Belief that NATO is Essential",
                           "Net Support for U.S.-EU Partnership",
                                "Change in Defense Spending"
                                # "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                # 8,
                           7,
                                16
                                # 17
                                ))





NATO.EUconv.Equ<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="Percent",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=subset(EuropeLong,MetricName %in% c("EquSpendDelt","NATO.EUspread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="MetricValue",
                             VAR.y.series="MetricName",
                             VAR.facet.primary="Country",
                             # VAR.facet.secondary="Country"
                             # MovingAverage=1
                             # MovingSides=1
                             DataLabels=FALSE
                             #                       ,VAR.override.coloration=NA
)
NATO.EUconv.Equ+aes(shape=factor(category,levels=labels.category.DF$variable))+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=category),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                           # "NATOessSpread",
                           "NATO.EUspread",
                                # "DefSpendDelt"
                                "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                # "Net Belief that NATO is Essential",
                                "Net Support for U.S.-EU Partnership",
                                # "Change in Defense Spending"
                                "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                # 8,
                           7,
                                # 16
                                17
                                ))

```
#Macroeconomic Variables

```{r MacroEconomics, echo=FALSE}

ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="GDP per Capita, Annual Percent Change",
    VAR.Y.label="Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeDefOrEqu,
    VAR.x.variable="GDPpCapDelt",
    VAR.y.variable="ExpenditureDelt"
    ,VAR.facet.primary="DefOrEqu"
    # ,VAR.y.series=NA
)

ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="GDP per Capita, Annual Percent Change",
    VAR.Y.label="Overall Defense Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="GDPpCapDelt",
    VAR.y.variable="DefSpendDelt"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)

ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="GDP per Capita, Annual Percent Change",
    VAR.Y.label="Defense Equipment Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="GDPpCapDelt",
    VAR.y.variable="EquSpendDelt"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)

GDPline<-LatticeLineWrapper(VAR.color.legend.label="",
                             VAR.main.label="",
                             VAR.X.label="Year",
                             VAR.Y.label="GDP per Capita, Annual Percent Change",
                             VAR.Coloration=Coloration,
                             VAR.long.DF=EuropeSample,
                             # ,VAR.ncol=NA
                             VAR.x.variable="Year",
                             VAR.y.variable="DefSpendDelt",
                             VAR.y.series="Country",
                             VAR.facet.primary="Country"
                             # VAR.facet.secondary=NA
                             # MovingAverage=1
                             # MovingSides=1
                             # DataLabels=NA
                             #                       ,VAR.override.coloration=NA
)

GDPline

```


#Parliamentary Variables

#Left Right

```{r Left_Right, echo=FALSE}
ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="Weighted Cabinet, Left=0 to Right=10",
    VAR.Y.label="Overall Defense Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="Cab_left_right",
    VAR.y.variable="DefSpendDelt"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)

ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="Weighted Cabinet, Left=0 to Right=10",
    VAR.Y.label="Defense Equipment Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="Cab_left_right",
    VAR.y.variable="EquSpendDelt"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)




# LeftRightLine<-LatticeLineWrapper(VAR.color.legend.label="",
#                              VAR.main.label="",
#                              VAR.X.label="Year",
#                              VAR.Y.label="Weighted Cabinet, Left=0 to Right=10",
#                              VAR.Coloration=Coloration,
#                              VAR.long.DF=subset(EuropeLong,MetricName %in% c("Cab_left_right",
#                                                                              "Opp_left_right")),
#                              # ,VAR.ncol=NA
#                              VAR.x.variable="Year",
#                              VAR.y.variable="MetricValue",
#                              VAR.y.series="MetricName",
#                              VAR.facet.primary="Country",
#                              # VAR.facet.secondary="Country"
#                              # MovingAverage=1
#                              # MovingSides=1
#                              DataLabels=FALSE
#                              #                       ,VAR.override.coloration=NA
# )
# LeftRightLine+geom_point()+
#     aes(shape=factor(category,levels=labels.category.DF$variable))+
#     theme(legend.position="bottom")+geom_ribbon(aes(ymin=0,ymax=1))
#     # scale_y_continuous(labels = percent_format())
# 
# 
# 
# 
# 
# 
# 
#     
#     debug(LatticeLineWrapper)
#     LeftRightLine<-LatticeLineWrapper(VAR.color.legend.label="",
#                                  VAR.main.label="",
#                                  VAR.X.label="Year",
#                                  VAR.Y.label="Weighted Cabinet, Left=0 to Right=10",
#                                  VAR.Coloration=Coloration,
#                                  VAR.long.DF=EuropeSample,
#     #                                  subset(EuropeLong,MetricName %in% c("Cab_left_right",
#     #                                                                              "Opp_left_right")),
#                                  VAR.ncol=5,
#                                  VAR.x.variable="Year",
#                                  # VAR.y.variable="MetricValue",
#                                  # VAR.y.series="MetricName",
#                                  VAR.y.variable="Cab_left_right",
#                                  VAR.y.series="Country",
#                                  VAR.facet.primary="Country",
#                                  VAR.facet.secondary=NA,
#     "Opp_left_right",
#                                  # MovingAverage=1
#                                  # MovingSides=1
#                                  DataLabels=FALSE
#                                                        ,VAR.override.coloration=NA
#     )
# LeftRightLine+geom_point(aes(x=x.variable,y=y.variable,shape="a",color="black",size=5))+
#     # aes(shape=factor(category,levels=labels.category.DF$variable))+
#     theme(legend.position="bottom")+geom_line(aes(x=x.variable,y=y.variable,color="black"))+
#     geom_line(aes(x=x.variable,y=Opp_left_right,color="balck"))+
#     geom_point(aes(x=x.variable,y=Opp_left_right,shape="d",color="black",size=5))+
#     geom_ribbon(aes(ymin=y.variable,ymax=Opp_left_right),alpha=0.25)
#     # scale_y_continuous(labels = percent_format())
# 
# EuropeLong<-ddply(EuropeLong,
#                   .(Country,Year),
#                   mutate,
#                   min_left_right=max(ifelse(MetricName %in% c("Cab_left_right","Opp_left_right"),MetricValue,NA),na.rm=TRUE),
#                   max_left_right=min(ifelse(MetricName %in% c("Cab_left_right","Opp_left_right"),MetricValue,NA),na.rm=TRUE)
# )
# debug(LatticeLineWrapper)
# LeftRightLine<-LatticeLineWrapper(VAR.color.legend.label="",
#                                  VAR.main.label="",
#                                  VAR.X.label="Year",
#                                  VAR.Y.label="Weighted Cabinet, Left=0 to Right=10",
#                                  VAR.Coloration=Coloration,
#                                  VAR.long.DF=subset(EuropeLong,MetricName %in% c("Cab_left_right",
#                                                                                  "Opp_left_right")),
#                                  VAR.ncol=5,
#                                  VAR.x.variable="Year",
#                                  VAR.y.variable="MetricValue",
#                                  VAR.y.series="MetricName",
#                                  VAR.facet.primary="Country",
#                                  VAR.facet.secondary=NA,
#                                  "min_left_right",
#                                  "max_left_right",
#                                  # MovingAverage=1
#                                  # MovingSides=1
#                                  DataLabels=FALSE
#                                                        ,VAR.override.coloration=NA
#     )
# LeftRightLine+geom_ribbon(aes(ymin=min_left_right,ymax=max_left_right,alpha=0.01))
# 
# ggplot(x, aes(x=x, y=twox)) + geom_line(aes(y = twox)) + geom_line(aes(y = x2)) +
#   geom_ribbon(data=subset(x, 2 <= x & x <= 3), aes(ymin=twox,ymax=x2), fill="blue", alpha="0.5") +
#   scale_y_continuous(expand = c(0, 0), limits=c(0,20)) +
#   scale_x_continuous(expand = c(0, 0), limits=c(0,5)) + scale_fill_manual(values=c(clear,blue))

LeftRightLine<-ggplot(data=EuropeSample,aes(x=Year))+theme_bw()+
    geom_line(aes(y=Cab_left_right))+
    geom_point(aes(y=Cab_left_right, shape=EuropeSample$Cabinet),size=5)+
    geom_line(aes(y=Opp_left_right))+
    geom_point(aes(y=Opp_left_right,shape=EuropeSample$Opposition),size=5)+
    # geom_ribbon(aes(ymin=Cab_left_right,ymax=Opp_left_right),alpha=0.25)+
    facet_wrap(~ Country)+
    ylab("Parliamentary Opinion\non Scale of Left (0) to Right (10)")+
    theme(legend.position="bottom",
          axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+scale_shape_manual(name="Cabinet or Opposition",
                       limits=c("Cabinet", "Opposition"),
                       labels=c("Cabinet", "Opposition"),
                       values=c(16,2))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))

# 
# LeftRightLine<-ggplot(data=EuropeSample,aes(x=Year),
#                xlab="Year")+
#     geom_line(aes(y=Cab_left_right),color="red",
#                ylab="Weighted Cabinet, Left=0 to Right=10")+
#     geom_point(aes(y=Cab_left_right),shape=16,color="red",size=5)+
#     geom_line(aes(y=Opp_left_right),color="blue")+
#     geom_point(aes(y=Opp_left_right),shape=2,color="blue",size=5)+
#         geom_ribbon(aes(ymin=Cab_left_right,ymax=Opp_left_right),alpha=0.25)+
# #     geom_ribbon(aes(ymin=ifelse(Cab_left_right>=Opp_left_right,Cab_left_right,NA),
# #                     ymax=ifelse(Cab_left_right>=Opp_left_right,Opp_left_right,NA)),alpha=0.25,fill="red")+
# #         geom_ribbon(aes(ymin=ifelse(Cab_left_right<Opp_left_right,Cab_left_right,NA),
# #                     ymax=ifelse(Cab_left_right<Opp_left_right,Opp_left_right,NA)),alpha=0.1,fill="blue")+
#     facet_wrap(~ Country)

LeftRightLine

```



#Liberty Authority

```{r Liberty_Authority, echo=FALSE}
ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="Weighted Cabinet, Liberty=0 to Authority=10",
    VAR.Y.label="Overall Defense Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="Cab_liberty_authority",
    VAR.y.variable="DefSpendDelt"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)

ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="Weighted Cabinet, Liberty=0 to Authority=10",
    VAR.Y.label="Defense Equipment Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="Cab_liberty_authority",
    VAR.y.variable="EquSpendDelt"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)




EuropeSample$Cabinet<-"Cabinet"
EuropeSample$Opposition<-"Opposition"
LibertyAuthorityLine<-ggplot(data=EuropeSample,aes(x=Year))+theme_bw()+
    geom_line(aes(y=Cab_liberty_authority))+
    geom_point(aes(y=Cab_liberty_authority, shape=EuropeSample$Cabinet),size=5)+
    geom_line(aes(y=Opp_liberty_authority))+
    geom_point(aes(y=Opp_liberty_authority,shape=EuropeSample$Opposition),size=5)+
    geom_ribbon(aes(ymin=Cab_liberty_authority,ymax=Opp_liberty_authority),alpha=0.25)+
    facet_wrap(~ Country)+
    ylab("Parliamentary Opinion\non Scale of GAL (0) to TAN (10)")+
    theme(legend.position="bottom",
          axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+scale_shape_manual(name="Cabinet or Opposition",
                       limits=c("Cabinet", "Opposition"),
                       labels=c("Cabinet", "Opposition"),
                       values=c(16,2))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))

# 
# LibertyAuthorityLine<-ggplot(data=EuropeSample,aes(x=Year),
#                xlab="Year",
#                ylab="Weighted Cabinet, Liberty=0 to Authority=10")+
#     
#     geom_line(aes(y=Cab_liberty_authority),color="red")+
#     geom_point(aes(y=Cab_liberty_authority),shape=16,color="red",size=5)+
#     geom_line(aes(y=Opp_liberty_authority),color="blue")+
#     geom_point(aes(y=Opp_liberty_authority),shape=2,color="blue",size=5)+
#         geom_ribbon(aes(ymin=Cab_liberty_authority,ymax=Opp_liberty_authority),alpha=0.25)+
#     geom_ribbon(aes(ymin=ifelse(Cab_liberty_authority>=Opp_liberty_authority,Cab_liberty_authority,NA),
#                     ymax=ifelse(Cab_liberty_authority>=Opp_liberty_authority,Opp_liberty_authority,NA)),alpha=0.25,fill="red")+
#         geom_ribbon(aes(ymin=ifelse(Cab_liberty_authority<Opp_liberty_authority,Cab_liberty_authority,NA),
#                     ymax=ifelse(Cab_liberty_authority<Opp_liberty_authority,Opp_liberty_authority,NA)),alpha=0.1,fill="blue")+
    # facet_wrap(~ Country)

LibertyAuthorityLine

```


#EU Anti Pro

```{r EU_Anti_Pro, echo=FALSE}
ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="Weighted Cabinet, Anti-EU=0 to Pro-EU=10",
    VAR.Y.label="Overall Defense Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="Cab_eu_anti_pro",
    VAR.y.variable="DefSpendDelt"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)

ScatterPlot(
    VAR.color.legend.label="",
    VAR.main.label="",
    VAR.X.label="Weighted Cabinet, Anti-EU=0 to Pro-EU=10",
    VAR.Y.label="Defense Equipment Spending, Annual Percent Change",
    Coloration,#VAR.Coloration
    VAR.base.row=1,
    VAR.base.col=1,
    VAR.long.DF=EuropeSample,
    VAR.x.variable="Cab_eu_anti_pro",
    VAR.y.variable="EquSpendDelt"
    # ,VAR.facet.primary=NA
    # ,VAR.y.series=NA
)



EUantiProLine<-ggplot(data=EuropeSample,aes(x=Year))+theme_bw()+
    geom_line(aes(y=Cab_eu_anti_pro))+#,color="red")+color=EuropeSample$Cabinet
    geom_point(aes(y=Cab_eu_anti_pro, shape=EuropeSample$Cabinet),size=5)+#shape=16,color="red",,color=EuropeSample$Cabinet
    geom_line(aes(y=Opp_eu_anti_pro))+#,color="blue")+, color=EuropeSample$Opposition
    geom_point(aes(y=Opp_eu_anti_pro,shape=EuropeSample$Opposition),size=5)+#shape=2,color="blue",color=EuropeSample$Opposition
    geom_ribbon(aes(ymin=Cab_eu_anti_pro,ymax=Opp_eu_anti_pro),alpha=0.25)+
    #     geom_ribbon(aes(ymin=ifelse(Cab_eu_anti_pro>=Opp_eu_anti_pro,Cab_eu_anti_pro,NA),
    #                     ymax=ifelse(Cab_eu_anti_pro>=Opp_eu_anti_pro,Opp_eu_anti_pro,NA)),alpha=0.25,fill="red")+
    #         geom_ribbon(aes(ymin=ifelse(Cab_eu_anti_pro<Opp_eu_anti_pro,Cab_eu_anti_pro,NA),
    #                     ymax=ifelse(Cab_eu_anti_pro<Opp_eu_anti_pro,Opp_eu_anti_pro,NA)),alpha=0.1,fill="blue")+
    facet_wrap(~ Country)+
    ylab("Parliamentary Opinion\non Scale of Anti-EU (0) to Pro-EU (10)")+
    theme(legend.position="bottom",
          axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+scale_shape_manual(name="Cabinet or Opposition",
                       limits=c("Cabinet", "Opposition"),
                       labels=c("Cabinet", "Opposition"),
                       values=c(16,2))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))


EUantiProLine

```


```{r SamplePercentOfNATOspending}
path="Data\\"

lookup.countries <- read.csv(paste(path, "CountryNameStandardize.csv", sep =""), header = TRUE)
data.nato <- read.csv(paste(path, "SSI_NATO.csv", sep =""), header = TRUE)
    data.ally <- melt(data.nato, id = "Year", variable.name="Country",value.name="NATOally")
    colnames(data.ally)[colnames(data.ally)=="year"] <- "Year"
    data.ally<-StandardizeCountries(data.ally,lookup.countries)
    NATO.countries<-unique(subset(data.ally,NATOally==1)$Country)
    
data.euds <- read.csv(paste(path, "European_Total_Constant_Euros.csv", sep =""), header = TRUE)
  data.euds<-RenameYearColumns(data.euds)
    data.euds<-subset(data.euds,select=-c(Region,X2001.2011,X2001.2010,X2001.2013))
    data.euds <- melt(data.euds, id=c("Country", "Unit.Currency"), variable.name="Year",value.name="DefSpnd")
    data.euds$DefSpnd <- as.numeric(gsub(",","",str_trim(as.character(data.euds$DefSpnd))))
    data.euds$Year <- as.integer(as.character(data.euds$Year))
    data.euds$DefSpnd <- data.euds$DefSpnd*1000000
    data.euds<-StandardizeCountries(data.euds,lookup.countries)

unique(data.euds$Country[!data.euds$Country %in% NATO.countries])
unique(NATO.countries[!NATO.countries %in% unique(data.euds$Country)])

data.euds.NATO<-subset(data.euds,Year==2014)
data.euds.NATO<-subset(data.euds.NATO,Country %in% NATO.countries)
data.euds.NATO$share<-data.euds.NATO$DefSpnd/sum(data.euds.NATO$DefSpnd,na.rm=TRUE)
#No Albania, but they aren't that big a spender.

sum(data.euds.NATO$share[data.euds.NATO$Country %in% c("France","Germany","United Kingdom","Italy","Netherlands","Poland",
                                                     "Portugal","Slovakia","Spain","Turkey")])
sum(data.euds.NATO$share[data.euds.NATO$Country %in% c("France","Germany","United Kingdom","Italy","Netherlands","Poland",
                                                     "Portugal","Spain")])
    
```




```{r HeterogeneityAcrossCountries}

library(gplots)
plotmeans(EquSpend_lead ~ Country, main="Heterogeineityacross countries", data=EuropeOmnibus)
# plotmeansdraw a 95% confidence interval around the means
detach("package:gplots")
# Remove package 'gplots' from the workspace
```