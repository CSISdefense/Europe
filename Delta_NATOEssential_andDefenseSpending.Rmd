---
title: "NATO Essential and Defense Spending"
author: "src"
date: "October 19, 2015"
output: html_document
---

**Load packages and support files**
```{r Setup, echo = FALSE, results = "hide"}
options(error=recover)
options(warn=1)

require(Hmisc)
require(texreg)
require(plm)
require(ggplot2)
require(reshape2)
require(plyr)
require(quantmod)

#Your working directory here!
# setwd("K:/Development/Europe") #Your working directory here!
#setwd("C:/Users/Greg Sanders/Documents/Development/Europe")
# setwd("C:/Users/scohen/My Documents/Europe/Git/Europe")

source("EuropeInput.R")

```


**Load and subset the data we want**
```{r Input, echo = FALSE, results = "hide"}


#debug(CompilePubOpDataOmnibus)
##load data using function
#undebug(CompilePubOpDataOmnibus)
EuropeOmnibus <- CompilePubOpDataOmnibus()


write.table(EuropeOmnibus
            ,file=paste("data\\EuropeOmnibus.csv"
                        ,sep=""
                        )
            #   ,header=TRUE
            , sep=","
            , row.names=FALSE
            , append=FALSE
            )


#get rid of greece
EuropeOmnibus <- subset(EuropeOmnibus, !Country %in% c("Greece", "Sweden","Russia","United States"))




write.table(EuropeOmnibus
            ,file=paste("data\\EuropeSample.csv"
                        ,sep=""
                        )
            #   ,header=TRUE
            , sep=","
            , row.names=FALSE
            , append=FALSE
            )
##change government spreads from factors



```


**load and subset the data we want**
```{r DefSpreadNarrowing, echo = FALSE, results = "hide"}

##load data using function
EuropeNATOessSpread <- subset(EuropeOmnibus, !is.na(DefSpendDelt_lead))

EuropeNATOessSpread_lag0 <- subset(EuropeNATOessSpread, !is.na(NATOessSpread))
EuropeNATOessSpread_lag1 <- subset(EuropeNATOessSpread, !is.na(NATOessSpread_lag1))
EuropeNATOessSpread_lag2<- subset(EuropeNATOessSpread, !is.na(NATOessSpread_lag2))


```



``` {r PublicOpinionLag, echo = TRUE}
NATOessSpreadDef_model<-list()
NATOessSpreadDef_name<-c()

reg<-1
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread, EuropeNATOessSpread_lag0))
NATOessSpreadDef_name[reg]<-"PubOp_ne1"
screenreg(NATOessSpreadDef_model[reg],
          custom.model.name=NATOessSpreadDef_name[reg])
summary(NATOessSpreadDef_model[[reg]])

reg<-2
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag1, EuropeNATOessSpread_lag1))
NATOessSpreadDef_name[reg]<-"PubOp_ne2"
screenreg(NATOessSpreadDef_model[reg],
          custom.model.name=NATOessSpreadDef_name[reg])
summary(NATOessSpreadDef_model[[reg]])

reg<-3
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"PubOp_ne3"
screenreg(NATOessSpreadDef_model[reg],
          custom.model.name=NATOessSpreadDef_name[reg])
summary(NATOessSpreadDef_model[[reg]])

screenreg(NATOessSpreadDef_model[c(1:3)],
          custom.model.name=NATOessSpreadDef_name[c(1:3)])


```

After comparing the three options, the three year difference between expenditure and Nato Essential polling appears to have the strongest relationship, even if it no where close to significant.


``` {r SecurityEnvironment, echo = TRUE}
reg<-4
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2  + IntAt, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"IntAt"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

#Drop in adjusted R^2, no significance.

reg<-5
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2  + DomAt, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"DomAt"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

reg<-6
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2 +  CivilWar, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"CivilWar"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

##Removing civil war, not significant,  small increase in R^2 and kills the pvalue of  NATOessSpread
reg<-7
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2  +IntlCnf, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"IntlCnf"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

#Small improvement from international conflict, but reduces p-value, so we'll leave it out.


```

Minimal gains from the security environment variables, and the signs were all in an unexpected direction.


``` {r MacroEconomics, echo = TRUE}

reg<-8
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2  + GDPpCapDelt, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"GDPpCapDelt"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

#Negative adjusted R^2, leaving out.




```

Not much changed, I substituted in GPDpCap as it wasn't much more powerful than Civil War, but had a better p value and the outcome made more sense. 


``` {r Cabinet, echo = TRUE}
reg<-9
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2  +Cab_left_right, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"CabLeftRight"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

#Minimal gains, odd sign.

reg<-10
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2  +Cab_liberty_authority, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"CabLibertyAuth"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

#Not significant. More of a gain but still, odd sign and reduces p-value. Rejecting.

reg<-11
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2  +Cab_eu_anti_pro, EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"CabEUantiPro"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

#No improvement in R^2. Does help p value, but not significant.


reg<-12
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2 + left_right_ls_spread  , EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"lr_spread"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

#Not significant, improvement in r^2 but reduces p-value of stud variable.


reg<-13
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2 +  liberty_authority_ls_spread , EuropeNATOessSpread_lag2))
NATOessSpreadDef_name[reg]<-"LA_spread"
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])
#Lowers adj r2 to no benefit. Not significant.

#liberty_authority spread rejected
reg<-14
NATOessSpreadDef_model[reg] <- list(lm(DefSpendDelt_lead ~ NATOessSpread_lag2   , EuropeNATOessSpread_lag2))
screenreg(NATOessSpreadDef_model[c(3,reg)],
          custom.model.name=NATOessSpreadDef_name[c(3,reg)])
summary(NATOessSpreadDef_model[[reg]])

#EU anti/pro also rejected.

```


NATOessSpreadDef_model[3] is chosen.



**Tests of within and pooling**

``` {r defspreadPoolingTest, echo = TRUE}

selected<-3
screenreg(NATOessSpreadDef_model[c(3)],
          custom.NATOessSpreadDef_name=NATOessSpreadDef_name[c(3)])
summary(NATOessSpreadDef_model[[selected]])
plot(NATOessSpreadDef_model[[selected]])

pooled<-15
NATOessSpreadDef_name[pooled]<-"pooling"
NATOessSpreadDef_model[pooled] <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2,
                          data = EuropeNATOessSpread_lag2, model = "pooling"))
summary(NATOessSpreadDef_model[[pooled]])

within<-16
NATOessSpreadDef_name[reg]<-"within"
NATOessSpreadDef_model[within] <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2 ,
                          data = EuropeNATOessSpread_lag2, model = "within"))
summary(NATOessSpreadDef_model[[within]])
# 
pFtest(NATOessSpreadDef_model[[pooled]],NATOessSpreadDef_model[[within]])
##p = NA. Cannot judge the null that the pooling model works (all coefficients for each country should be the same ever year)

```


**Fixed Effects model** (within)
```{r DefSpreadFixed, echo = TRUE}

screenreg(NATOessSpreadDef_model[c(selected,within)],
          custom.model.name=NATOessSpreadDef_name[c(selected,within)])

#testing for fixed effects
pFtest(NATOessSpreadDef_model[[within]], NATOessSpreadDef_model[[selected]]
       )

#p = 1, cannot reject null hypothesis that there are not significant effects, use pooled 

```

Haufman test, p-value = 1.

**Compare Fixed effects to random effects** 

``` {r DefSperadHausmanTest, echo = TRUE}

withinindex<-17
NATOessSpreadDef_name[withinindex]<-"withinindex"
NATOessSpreadDef_model[withinindex] <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2 ,
                          data = EuropeNATOessSpread_lag2, index=c("Country", "Year"), model = "within"))
summary(NATOessSpreadDef_model[[withinindex]])

screenreg(NATOessSpreadDef_model[c(selected,within,withinindex)] ,
          custom.model.name=NATOessSpreadDef_name[c(selected,within,withinindex)])


randomindex<-18
# NATOessSpreadDef_model[withinindex] <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2  ,
#                           data = EuropeNATOessSpread_lag2, index=c("Country", "Year"), model = "random"))
# summary(NATOessSpreadDef_model[[randomindex]])
# # 
# Fails: Error in swar(object, data, effect) : 
#   the estimated variance of the individual effect is negative

# screenreg(NATOessSpreadDef_model[c(selected,within,withinindex,randomindex)] ,
#           custom.model.name=NATOessSpreadDef_name[c(selected,within,withinindex,randomindex)])

# pFtest(NATOessSpreadDef_model[[withinindex]], NATOessSpreadDef_model[[randomindex]])

##p-value Uncalculated reject null, which makes sense because it told us before to do pooled. 
```
