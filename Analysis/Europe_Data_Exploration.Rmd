---
title: "Europe Data Exploration"
author: "Greg Sanders"
date: "October 25, 2015"
output: 
  html_document: 
    fig_caption: yes
    keep_md: yes
    toc: yes
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


# Setup
```{r Setup, echo = FALSE, results = "hide", warning=FALSE, message=FALSE}
#*************************************Required Libraries******************************************
require(plyr)
require(grid)
require(reshape2)
require(stringr)
require(ggplot2)
require(stringr)
library(csis360)
#*************************************Options*****************************************************
options(error=recover)
options(warn=1)
#*************************************Lookup Files*****************************************************
# Path<-"K:\\2007-01 PROFESSIONAL SERVICES\\R scripts and data\\"
# Path<-"~\\FPDS\\R scripts and data\\"
# Path<-"F:\\Users\\Greg\\Repositories"
# Path<-"C:\\Users\\Greg Sanders\\SkyDrive\\Documents\\R Scripts and Data SkyDrive\\"
Path<-file.path("..","..","R-scripts-and-data")

legend.text.size<-10
axis.text.size<-10
strip.text.size<-10
legend.text.size<-10

table.text.size<-11
title.text.size<-12
geom.text.size<-1.5

source("..//Scripts//EuropeInput.R")

source(file.path(Path,"helper.r"))
source(file.path(Path,"lookups.r"))


Coloration<-read.csv(
    file.path(Path,"Lookups\\","lookup_coloration.csv"),
    header=TRUE, sep=",", na.strings="", dec=".", strip.white=TRUE, 
    stringsAsFactors=FALSE
    )

Coloration<-ddply(Coloration
                  , c(.(R), .(G), .(B))
                  , transform
                  , ColorRGB=as.character(
                      if(min(is.na(c(R,G,B)))) {NA} 
                      else {rgb(max(R),max(G),max(B),max=255)}
                      )
                  )

```

## Dataset Prep
```{r PreparingDataset}

EuropeSample<-read.csv("..\\Data\\EuropeSample.csv", 
                                 header = TRUE) 

EuropeSample$Cabinet<-"Cabinet"
EuropeSample$Opposition<-"Opposition"

EuropeDefOrEquDelt<-melt(EuropeSample,
                 measure.vars=c("DefSpendDelt","DefSpendDelt_lead",
                                "EquSpendDelt","EquSpendDelt_lead",
                                "OnMspendDelt","OnMspendDelt_lead"),
                 variable.name="DefOrEqu",
                 value.name = "ExpenditureDelt")


EuropeDefOrEqu<-melt(EuropeSample,
                 measure.vars=c("DefSpend","DefSpend_lead",
                                "EquSpend","EquSpend_lead",
                                "OnMspend","OnMspend_lead"),
                 variable.name="DefOrEqu",
                 value.name = "Expenditure")

EuropeLong<-melt(EuropeSample,
                     id.vars=c("Country","Year"),
                 measure.vars=c("DefSpendDelt","DefSpendDelt_lead",
                                "EquSpendDelt_lead","EquSpendDelt",
                                "OnMspendDelt_lead","OnMspendDelt",
                                "DefSpend","DefSpend_lead",
                                "EquSpend_lead","EquSpend",
                                "OnMspend_lead","OnMspend",
                                "DefSpread","DefSpread_lag1","DefSpread_lag2",
                                "EUldrSpread","EUldrSpread_lag1","EUldrSpread_lag2",
                                "NATOessSpread","NATOessSpread_lag1","NATOessSpread_lag2", 
                                "EUcloserUSspread", "EUcloserUSspread_lag1","EUcloserUSspread_lag2",
                                "NGDP_eu2014","NGDP_eu2014Delt","EUdebt_NGDP","Dfc_NGDP","Debt_NGDP",
                                "IntAt", "DomAt","GCivilWarBRD","UNmilitaryPMil","RussiaDefSpend",
                                "Cab_left_right","Opp_left_right","left_right_ls_spread",
                                "Cab_liberty_authority","Opp_liberty_authority","liberty_authority_ls_spread",
                                "Cab_eu_anti_pro","Opp_eu_anti_pro","Opp_eu_anti_pro"),
                 variable.name="MetricName",
                 value.name = "MetricValue")

        

EuropeLong<-subset(EuropeLong,!is.na(MetricValue))


             
```

You can also embed plots, for example:

#Dependent Variables

```{r DependentVariablesDelt, echo=FALSE}
Eur_lc<-prepare_labels_and_colors(EuropeSample)
Eur_ck<-get_column_key(EuropeSample)

(DefLineDelt  <-  build_plot(
  data=EuropeSample,
                            chart_geom="Line Chart",
                            share=FALSE,
                            x_var="Year",
                            y_var="DefSpendDelt",
                            # color_var="Country",
                            facet_var="Country",
                            # second_var="BuyerStateRegion",
                            labels_and_colors=Eur_lc,
                            column_key=Eur_ck,
                            legend=TRUE,
                            caption=FALSE,
                        format=TRUE)+#facet_wrap(~Buyer)+#, scales="free_y"
  labs(x="Year",
       y="Change in Total Defense Spending"#,
       # caption="Source: EDA and CSIS analysis.")
       ))+#scale_color_manual(color="black")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous(labels = percent_format())+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))

# +
#     geom_shape()
#     scale_shape_manual(name="Spending",
#                                                                 limits=c("DefSpread",
#                                                                          "DefSpendDelta"),
#                                                                 labels=c("Net Support for Defense Spending", 
#                                                                          "Change in Defense Spending"),
#                                                                 values=c(16,2))
# +
#     scale_line_manual(name="Spending",
#                                                                 limits=c("DefSpread",
#                                                                          "DefSpendDelta"),
#                                                                 labels=c("Net Support for Defense Spending", 
#                                                                          "Change in Defense Spending"),
#                                                                 values=c(16,2))


(EquLineDelt  <-  build_plot(
  data=EuropeSample,
                            chart_geom="Line Chart",
                            share=FALSE,
                            x_var="Year",
                            y_var="EquSpendDelt",
                            # color_var="Country",
                            facet_var="Country",
                            # second_var="BuyerStateRegion",
                            labels_and_colors=Eur_lc,
                            column_key=Eur_ck,
                            legend=TRUE,
                            caption=FALSE,
                        format=TRUE)+#facet_wrap(~Buyer)+#, scales="free_y"
  labs(x="Year",
       y="Change in Defense Equipment Spending"#,
       # caption="Source: EDA and CSIS analysis.")
       ))+#scale_color_manual(color="black")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous(labels = percent_format())+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))





(OnMLineDelt  <-  build_plot(
  data=EuropeSample,
                            chart_geom="Line Chart",
                            share=FALSE,
                            x_var="Year",
                            y_var="OnMspendDelt",
                            # color_var="Country",
                            facet_var="Country",
                            # second_var="BuyerStateRegion",
                            labels_and_colors=Eur_lc,
                            column_key=Eur_ck,
                            legend=TRUE,
                            caption=FALSE,
                        format=TRUE)+#facet_wrap(~Buyer)+#, scales="free_y"
  labs(x="Year",
       y="Change in Defense Operations & Maintenance/Other Spending"#,
       # caption="Source: EDA and CSIS analysis.")
       ))+#scale_color_manual(color="black")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous(labels = percent_format())+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))


ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=EquSpendDelt))+geom_point()
ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=OnMspendDelt))+geom_point()
ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=DefSpread))+geom_point()
ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=EUldrSpread))+geom_point()


(TriLine  <-  build_plot(
  data=subset(EuropeDefOrEquDelt,DefOrEqu %in%
                c("DefSpendDelt","EquSpendDelt","OnMspendDelt")),
                            chart_geom="Line Chart",
                            share=FALSE,
                            x_var="Year",
                            y_var="ExpenditureDelt",
                            # color_var="Country",
                            facet_var="DefOrEqu",
                            second_var="Country",
                            labels_and_colors=Eur_lc,
                            column_key=Eur_ck,
                            legend=TRUE,
                            caption=FALSE,
                        format=TRUE)+#facet_wrap(~Buyer)+#, scales="free_y"
  labs(x="Year",
       y="Expenditures, Annual Percent Change"#,
       # caption="Source: EDA and CSIS analysis.")
       ))+#scale_color_manual(color="black")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous(labels = percent_format())+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))



(build_plot(
  data=EuropeSample,
                            chart_geom="Scatter Plot",
                            share=FALSE,
                            x_var="DefSpendDelt",
                            y_var="DefSpendDelt_lead",
                            # color_var="Country",
                            # facet_var="DefOrEqu",
                            # second_var="Country",
                            labels_and_colors=Eur_lc,
                            column_key=Eur_ck,
                            legend=TRUE,
                            caption=FALSE,
                        format=TRUE)
) +labs(x="Top-Line Defense Spending, Annual Percent Change (T=0)",
       y="Top-Line Defense Spending, Annual Percent Change (T=-1)"#,
       # caption="Source: EDA and CSIS analysis.")
       )

(build_plot(
  data=EuropeSample,
                            chart_geom="Scatter Plot",
                            share=FALSE,
                            x_var="EquSpendDelt",
                            y_var="EquSpendDelt_lead",
                            # color_var="Country",
                            # facet_var="DefOrEqu",
                            # second_var="Country",
                            labels_and_colors=Eur_lc,
                            column_key=Eur_ck,
                            legend=TRUE,
                            caption=FALSE,
                        format=TRUE)
) +labs(x="Defense Equipment Spending, Annual Percent Change (T=0)",
       y="Defense Equipment Spending, Annual Percent Change (T=-1)"#,
       # caption="Source: EDA and CSIS analysis.")
       )


(build_plot(
  data=EuropeSample,
                            chart_geom="Scatter Plot",
                            share=FALSE,
                            x_var="OnMspendDelt",
                            y_var="OnMspendDelt_lead",
                            # color_var="Country",
                            # facet_var="DefOrEqu",
                            # second_var="Country",
                            labels_and_colors=Eur_lc,
                            column_key=Eur_ck,
                            legend=TRUE,
                            caption=FALSE,
                        format=TRUE)
) +labs(x="Defense Operations & Maintenace/Other Spending, Annual Percent Change (T=0)",
       y="Defense Operations & Maintenace/Other Spending, Annual Percent Change (T=-1)"#,
       # caption="Source: EDA and CSIS analysis.")
       )




```

## Logged
```{r DependentVariablesLog, echo=FALSE}

(DefLine<-build_plot(
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=EuropeSample,
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="DefSpend",
                             # color_var="Country",
                             facet_var="Country",
                             # second_var=NA
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Total Defense Spending, Logarithmic Scale")+
  geom_line(aes(x=Year,y=DefSpend),color="black")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous("Defense Spending",labels = scales::comma)+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.text.y = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014)))



#Unmodified across one row per country
DefLine+facet_grid(Country~.,scales="free_y")+theme(axis.text.y = element_text(angle = 0, hjust = 1))+
    theme(strip.text.y=element_text(angle=0))


#Logs across three rows.
DefLineLog<-DefLine+aes(y=log(y.variable))+
    scale_y_continuous("Log of Defense Spending",labels = scales::comma)

DefLineLog

#Logs across one row per country
DefLineLog+facet_grid(Country~.,scales="free_y")+theme(axis.text.y = element_text(angle = 0, hjust = 1))+
    theme(strip.text.y=element_text(angle=0))




# +
#     geom_shape()
#     scale_shape_manual(name="Spending",
#                                                                 limits=c("DefSpread",
#                                                                          "DefSpendDelta"),
#                                                                 labels=c("Net Support for Defense Spending", 
#                                                                          "Change in Defense Spending"),
#                                                                 values=c(16,2))
# +
#     scale_line_manual(name="Spending",
#                                                                 limits=c("DefSpread",
#                                                                          "DefSpendDelta"),
#                                                                 labels=c("Net Support for Defense Spending", 
#                                                                          "Change in Defense Spending"),
#                                                                 values=c(16,2))



EquLine<-build_plot(
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=EuropeSample,
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="EquSpend",
                             # color_var="Country",
                             facet_var="Country",
                             # second_var=NA
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Defense Equipment Spending, Logarithmic Scale")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous("Equipment Spending",labels = scales::comma)+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))



#Unmodified across one row per country
EquLine+facet_grid(Country~.,scales="free_y")+theme(axis.text.y = element_text(angle = 0, hjust = 1))+
    theme(strip.text.y=element_text(angle=0))


#Logs across three rows.
EquLineLog<-EquLine+aes(y=log(y.variable))+
    scale_y_continuous("Log of Defense Equipment Spending",labels = scales::comma)

EquLineLog

#Logs across one row per country
EquLineLog+facet_grid(Country~.,scales="free_y")+theme(axis.text.y = element_text(angle = 0, hjust = 1))+
    theme(strip.text.y=element_text(angle=0))




OnMline<-build_plot(
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=EuropeSample,
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="OnMspend",
                             # color_var="Country",
                             facet_var="Country",
                             # second_var=NA
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Defense Operations & Maintenance/Other Spending, Logarithmic Scale")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous("Operations and Maintenance/Other Spending",labels = scales::comma)+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))




#Unmodified across one row per country
OnMline+facet_grid(Country~.,scales="free_y")+theme(axis.text.y = element_text(angle = 0, hjust = 1))+
    theme(strip.text.y=element_text(angle=0))


#Logs across three rows.
OnMlineLog<-OnMline+aes(y=log(y.variable))+
    scale_y_continuous("Log of Operations and Maintenance/Other Equipment Spending",labels = scales::comma)

OnMlineLog

#Logs across one row per country
OnMlineLog+facet_grid(Country~.,scales="free_y")+theme(axis.text.y = element_text(angle = 0, hjust = 1))+
    theme(strip.text.y=element_text(angle=0))


ggplot(data=subset(EuropeSample,Country=="Spain"),aes(x=Year,y=log(EquSpend)))+geom_point()



TriLine<-build_plot(
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeDefOrEqu,DefOrEqu %in%
                                                    c("DefSpend","EquSpend","OnMspend") &
                                                    !is.na(Expenditure)),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="Expenditure",
                             color_var="Country",
                             facet_var="DefOrEqu",
                             second_var="Country"
                             
                             
                             # DataLabels=NA
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Expenditures, Logged")
Triline<-TriLine+aes(y=log(y.variable))
Triline



```

#Polling
## Defense Too Much Too Little
```{r DefTooMuchTooLittle}

(
DefTooMuchTooLittle.Def<-build_plot(
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("DefSpendDelt","DefSpread")),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country"
                             # second_var="Country"
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
  geom_point()+
    aes(x=Year, y=MetricValue, shape=factor(MetricName))+#,levels=labels.category.DF$variable
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c("DefSpread",
                                "DefSpendDelt"),
                       labels=c("Net Support for Defense Spending", 
                                "Change in Defense Spending"),
                       values=c(1,16))
)



(
DefTooMuchTooLittle.Equ<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("EquSpendDelt","DefSpread")),
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
)+labs(x="Year",y="Percent")+
    geom_point()+
    aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c("DefSpread",
                                # "DefSpendDelt",
                                "EquSpendDelt"),
                       labels=c("Net Support for Defense Spending", 
                                # "Change in Defense Spending",
                                "Change in Equipment Spending"),
                       values=c(1,
                                # 16,
                                17))
)

(
DefTooMuchTooLittle.OnM<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("OnMspendDelt","DefSpread")),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+geom_point()+
    aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c("DefSpread",
                                # "DefSpendDelt",
                                "OnMspendDelt"),
                       labels=c("Net Support for Defense Spending", 
                                # "Change in Defense Spending",
                                "Change in Operations & Maintenance/Other Spending"),
                       values=c(1,
                                # 16,
                                17)))
```




## EU Leadership

```{r EUleadership}
(EUleadership.Def<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("DefSpendDelt","EUldrSpread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                "EUldrSpread",
                                "DefSpendDelt"
                                # "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                "Net Desire for Strong EU Leadership",
                                "Change in Defense Spending"
                                # "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                4,
                                16
                                # 17
                                )))


(EUleadership.Equ<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("EquSpendDelt","EUldrSpread") &
                                                     Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
geom_point()+aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                "EUldrSpread",
                                # "DefSpendDelt"
                                "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                "Net Desire for Strong EU Leadership",
                                # "Change in Defense Spending"
                                "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                4,
                                # 16
                                17
                                )))

(
EUleadership.OnM<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("OnMspendDelt","EUldrSpread") &
                                                     Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
geom_point()+aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                "EUldrSpread",
                                # "DefSpendDelt"
                                "OnMspendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                "Net Desire for Strong EU Leadership",
                                # "Change in Defense Spending"
                                "Change in Operations & Maintenance / Other Spending"
                                ),
                       values=c(
                           # 1,
                                4,
                                # 16
                                17
                                ))
)
```
## NATO Essential
```{r NATOess}

(NATOessen.Def<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("DefSpendDelt","NATOessSpread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
  aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                                "NATOessSpread",
                                "DefSpendDelt"
                                # "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                "Net Belief that NATO is Essential",
                                "Change in Defense Spending"
                                # "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                8,
                                16
                                # 17
                                )))





(NATOessen.Equ<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("EquSpendDelt","NATOessSpread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                           "NATOessSpread",
                                # "DefSpendDelt"
                                "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                "Net Belief that NATO is Essential",
                                # "Change in Defense Spending"
                                "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                8,
                                # 16
                                17
                                )))



(NATOessen.OnM<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("OnMspendDelt","NATOessSpread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
  aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                           "NATOessSpread",
                                # "DefSpendDelt"
                                "OnMspendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                "Net Belief that NATO is Essential",
                                # "Change in Defense Spending"
                                "Change in Operations & Maintenance/Other Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                8,
                                # 16
                                17
                                ))
)

```
## EU Closer to the U.S.

```{r EUcloserUS}
(EUcloserUSconv.Def<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("DefSpendDelt","EUcloserUSspread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
  aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                                # "NATOessSpread",
                                "EUcloserUSspread",
                                "DefSpendDelt"
                                # "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                # "Net Belief that NATO is Essential",
                           "Net Support for U.S.-EU Partnership",
                                "Change in Defense Spending"
                                # "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                # 8,
                           7,
                                16
                                # 17
                                )))





(EUcloserUSconv.Equ<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("EquSpendDelt","EUcloserUSspread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
    aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                           # "NATOessSpread",
                           "EUcloserUSspread",
                                # "DefSpendDelt"
                                "EquSpendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                # "Net Belief that NATO is Essential",
                                "Net Support for U.S.-EU Partnership",
                                # "Change in Defense Spending"
                                "Change in Equipment Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                # 8,
                           7,
                                # 16
                                17
                                )))




(EUcloserUSconv.OnM<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=subset(EuropeLong,MetricName %in% c("OnMspendDelt","EUcloserUSspread")&
                                                    Country!="Slovakia"),
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="MetricValue",
                             color_var="MetricName",
                             facet_var="Country",
                             # second_var="Country"
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",y="Percent")+
  aes(x=Year, y=MetricValue, shape=factor(MetricName))+ #,levels=labels.category.DF$variable)+
    theme(legend.position="bottom")+
    scale_y_continuous(labels = percent_format())+
    geom_line(color="black")+
    geom_point(color="black",aes(shape=MetricName),size=3)+
    scale_color_discrete(guide=F)+
    theme_bw()+
    theme(legend.position="bottom")+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))+    
    scale_shape_manual(name="Polling and Spending Metrics",
                       limits=c(
                            # "DefSpread",
                                # "EUldrSpread",
                           # "NATOessSpread",
                           "EUcloserUSspread",
                                # "DefSpendDelt"
                                "OnMspendDelt"
                                ),
                       labels=c(
                           # "Net Support for Defense Spending", 
                                # "Net Desire for Strong EU Leadership",
                                # "Net Belief that NATO is Essential",
                                "Net Support for U.S.-EU Partnership",
                                # "Change in Defense Spending"
                                "Change in Operations & Maintenance/Other Spending"
                                ),
                       values=c(
                           # 1,
                                # 4,
                                # 8,
                           7,
                                # 16
                                17
                                )))

```
#Macroeconomic Variables

```{r MacroEconomics, echo=FALSE}

(build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,
    data=EuropeDefOrEquDelt,
    x_var="NGDP_eu2014Delt",
    y_var="ExpenditureDelt"
    ,facet_var="DefOrEqu"
    # ,color_var=NA
)+labs(x="GDP per Capita, Annual Percent Change",
       "Spending, Annual Percent Change"))

(build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,
    data=EuropeSample,
    x_var="NGDP_eu2014Delt",
    y_var="DefSpendDelt",
    # ,facet_var=NA
    # ,color_var=NA
)+labs(x="GDP per Capita, Annual Percent Change",
       "Overall Defense Spending, Annual Percent Change"))

(build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,
    data=EuropeSample,
    x_var="NGDP_eu2014Delt",
    y_var="EquSpendDelt"
    # ,facet_var=NA
    # ,color_var=NA
)+labs(x="GDP per Capita, Annual Percent Change",
       "Defense Equipment Spending, Annual Percent Change"))

(GDPlineDelt<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=EuropeSample,
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="NGDP_eu2014Delt",
                             color_var="Country",
                             facet_var="Country"
)+labs(x="Year",
       "GDP in 2014 Euros, Annual Percent Change"))

(GDPline<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=EuropeSample,
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="NGDP_eu2014",
                             color_var="Country",
                             facet_var="Country",
                             # second_var=NA
                             #                       ,VAR.override.coloration=NA
)+labs(x="Year",
       y="GDP in 2014 Euros, Annual Percent Change")+
  geom_line(aes(x=Year,y=NGDP_eu2014),color="black")+
    scale_color_discrete(guide=F)+
    theme_bw()+
    scale_y_continuous("GDP",labels = scales::comma)+
    theme(axis.text.x = element_text(angle = 90, hjust = 1),
          axis.text.y = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014)))



#Unmodified across one row per country
GDPline+facet_grid(Country~.,scales="free_y")+
  theme(axis.text.y = element_text(angle = 0, hjust = 1))+
    theme(strip.text.y=element_text(angle=0))


#Logs across three rows.
GDPlineLog<-GDPline+aes(y=log(y.variable))+
    scale_y_continuous("Log of GDP",labels = scales::comma)

GDPlineLog

# 
# 
# EUdebt_NGDP<-ggplot(aes(x=Year,
#                         y=EUdebt_NGDP),
#                     data=EuropeSample
# )+geom_line()
# 
# 
# EUdebt_NGDP



(DeficitLine<-build_plot(chart_geom="Line Chart",
                             labels_and_colors=Eur_lc,column_key=Eur_ck,
                             data=EuropeSample,
                             # ,VAR.ncol=NA
                             x_var="Year",
                             y_var="Dfc_NGDP",
                             color_var="Country",
                             facet_var="Country",
                             # second_var=NA
                             
                             
                             
                             #                       ,VAR.override.coloration=NA
))+labs(x="Year",y="Deficit as Percent of GDP")



(EUdebt_NGDP<-ggplot(aes(x=Year,
                        y=MetricValue,
                        color=MetricName),
                    data=subset(EuropeLong,MetricName %in% c("EUdebt_NGDP","Debt_NGDP")))+
    geom_line()+facet_wrap(~Country)
)

(
DebtPlusDeficit_NGDP<-ggplot(aes(x=Year,
                        y=MetricValue,
                        color=MetricName),
                    data=subset(EuropeLong,MetricName %in% c("EUdebt_NGDP","Debt_NGDP","Dfc_NGDP")))+
    geom_line()+facet_wrap(~Country)
)





(GDPdeltPlusDeficit_NGDP<-ggplot(aes(x=Year,
                        y=MetricValue,
                        color=MetricName),
                    data=subset(EuropeLong,MetricName %in% c("NGDP_eu2014Delt","Dfc_NGDP")))+
    geom_line()+facet_wrap(~Country)
)

```


#Parliamentary Variables

##Left Right

```{r Left_Right, echo=FALSE}
(build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,
    data=EuropeSample,
    x_var="Cab_left_right",
    y_var="DefSpendDelt"
    # ,facet_var=NA
    # ,color_var=NA
)+labs(x="Weighted Cabinet, Left=0 to Right=10",
       y="Overall Defense Spending, Annual Percent Change"))

(build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,


    data=EuropeSample,
    x_var="Cab_left_right",
    y_var="EquSpendDelt"
    # ,facet_var=NA
    # ,color_var=NA
)+labs(x="Weighted Cabinet, Left=0 to Right=10",
       y="Defense Equipment Spending, Annual Percent Change"))





# LeftRightLine<-build_plot(chart_geom="Line Chart",
#                              
#                              VAR.X.label="Year",
#                              VAR.Y.label="Weighted Cabinet, Left=0 to Right=10",
#                              labels_and_colors=Eur_lc,column_key=Eur_ck,
#                              data=subset(EuropeLong,MetricName %in% c("Cab_left_right",
#                                                                              "Opp_left_right")),
#                              # ,VAR.ncol=NA
#                              x_var="Year",
#                              y_var="MetricValue",
#                              color_var="MetricName",
#                              facet_var="Country",
#                              # second_var="Country"
#                              
#                              
#                              
#                              #                       ,VAR.override.coloration=NA
# )
# LeftRightLine+geom_point()+
#     aes(shape=factor(category,levels=labels.category.DF$variable))+
#     theme(legend.position="bottom")+geom_ribbon(aes(ymin=0,ymax=1))
#     # scale_y_continuous(labels = percent_format())
# 
# 
# 
# 
# 
# 
# 
#     
#     debug(build_plot)
#     LeftRightLine<-build_plot(chart_geom="Line Chart",
#                                  
#                                  VAR.X.label="Year",
#                                  VAR.Y.label="Weighted Cabinet, Left=0 to Right=10",
#                                  labels_and_colors=Eur_lc,column_key=Eur_ck,
#                                  data=EuropeSample,
#     #                                  subset(EuropeLong,MetricName %in% c("Cab_left_right",
#     #                                                                              "Opp_left_right")),
#                                  VAR.ncol=5,
#                                  x_var="Year",
#                                  # y_var="MetricValue",
#                                  # color_var="MetricName",
#                                  y_var="Cab_left_right",
#                                  color_var="Country",
#                                  facet_var="Country",
#                                  second_var=NA,
#     "Opp_left_right",
#                                  
#                                  
#                                  
#                                                        ,VAR.override.coloration=NA
#     )
# LeftRightLine+geom_point(aes(x=x.variable,y=y.variable,shape="a",color="black",size=5))+
#     # aes(shape=factor(category,levels=labels.category.DF$variable))+
#     theme(legend.position="bottom")+geom_line(aes(x=x.variable,y=y.variable,color="black"))+
#     geom_line(aes(x=x.variable,y=Opp_left_right,color="balck"))+
#     geom_point(aes(x=x.variable,y=Opp_left_right,shape="d",color="black",size=5))+
#     geom_ribbon(aes(ymin=y.variable,ymax=Opp_left_right),alpha=0.25)
#     # scale_y_continuous(labels = percent_format())
# 
# EuropeLong<-ddply(EuropeLong,
#                   .(Country,Year),
#                   mutate,
#                   min_left_right=max(ifelse(MetricName %in% c("Cab_left_right","Opp_left_right"),MetricValue,NA),na.rm=TRUE),
#                   max_left_right=min(ifelse(MetricName %in% c("Cab_left_right","Opp_left_right"),MetricValue,NA),na.rm=TRUE)
# )
# debug(build_plot)
# LeftRightLine<-build_plot(chart_geom="Line Chart",
#                                  
#                                  VAR.X.label="Year",
#                                  VAR.Y.label="Weighted Cabinet, Left=0 to Right=10",
#                                  labels_and_colors=Eur_lc,column_key=Eur_ck,
#                                  data=subset(EuropeLong,MetricName %in% c("Cab_left_right",
#                                                                                  "Opp_left_right")),
#                                  VAR.ncol=5,
#                                  x_var="Year",
#                                  y_var="MetricValue",
#                                  color_var="MetricName",
#                                  facet_var="Country",
#                                  second_var=NA,
#                                  "min_left_right",
#                                  "max_left_right",
#                                  
#                                  
#                                  
#                                                        ,VAR.override.coloration=NA
#     )
# LeftRightLine+geom_ribbon(aes(ymin=min_left_right,ymax=max_left_right,alpha=0.01))
# 
# ggplot(x, aes(x=x, y=twox)) + geom_line(aes(y = twox)) + geom_line(aes(y = x2)) +
#   geom_ribbon(data=subset(x, 2 <= x & x <= 3), aes(ymin=twox,ymax=x2), fill="blue", alpha="0.5") +
#   scale_y_continuous(expand = c(0, 0), limits=c(0,20)) +
#   scale_x_continuous(expand = c(0, 0), limits=c(0,5)) + scale_fill_manual(values=c(clear,blue))

LeftRightLine<-ggplot(data=EuropeSample,aes(x=Year))+theme_bw()+
    geom_line(aes(y=Cab_left_right))+
    geom_point(aes(y=Cab_left_right, shape=EuropeSample$Cabinet),size=5)+
    geom_line(aes(y=Opp_left_right))+
    geom_point(aes(y=Opp_left_right,shape=EuropeSample$Opposition),size=5)+
    # geom_ribbon(aes(ymin=Cab_left_right,ymax=Opp_left_right),alpha=0.25)+
    facet_wrap(~ Country)+
    ylab("Parliamentary Opinion\non Scale of Left (0) to Right (10)")+
    theme(legend.position="bottom",
          axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+scale_shape_manual(name="Cabinet or Opposition",
                       limits=c("Cabinet", "Opposition"),
                       labels=c("Cabinet", "Opposition"),
                       values=c(16,2))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))

# 
# LeftRightLine<-ggplot(data=EuropeSample,aes(x=Year),
#                xlab="Year")+
#     geom_line(aes(y=Cab_left_right),color="red",
#                ylab="Weighted Cabinet, Left=0 to Right=10")+
#     geom_point(aes(y=Cab_left_right),shape=16,color="red",size=5)+
#     geom_line(aes(y=Opp_left_right),color="blue")+
#     geom_point(aes(y=Opp_left_right),shape=2,color="blue",size=5)+
#         geom_ribbon(aes(ymin=Cab_left_right,ymax=Opp_left_right),alpha=0.25)+
# #     geom_ribbon(aes(ymin=ifelse(Cab_left_right>=Opp_left_right,Cab_left_right,NA),
# #                     ymax=ifelse(Cab_left_right>=Opp_left_right,Opp_left_right,NA)),alpha=0.25,fill="red")+
# #         geom_ribbon(aes(ymin=ifelse(Cab_left_right<Opp_left_right,Cab_left_right,NA),
# #                     ymax=ifelse(Cab_left_right<Opp_left_right,Opp_left_right,NA)),alpha=0.1,fill="blue")+
#     facet_wrap(~ Country)

LeftRightLine

```



##Liberty Authority

```{r Liberty_Authority, echo=FALSE}
build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,
    data=EuropeSample,
    x_var="Cab_liberty_authority",
    y_var="DefSpendDelt"
    # ,facet_var=NA
    # ,color_var=NA
)+labs(x="Weighted Cabinet, Liberty=0 to Authority=10",
       y="Overall Defense Spending, Annual Percent Change")

build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,
    data=EuropeSample,
    x_var="Cab_liberty_authority",
    y_var="EquSpendDelt"
    # ,facet_var=NA
    # ,color_var=NA
)+labs(x="Weighted Cabinet, Liberty=0 to Authority=10",
       y="Defense Equipment Spending, Annual Percent Change")





EuropeSample$Cabinet<-"Cabinet"
EuropeSample$Opposition<-"Opposition"
LibertyAuthorityLine<-ggplot(data=EuropeSample,aes(x=Year))+theme_bw()+
    geom_line(aes(y=Cab_liberty_authority))+
    geom_point(aes(y=Cab_liberty_authority, shape=EuropeSample$Cabinet),size=5)+
    geom_line(aes(y=Opp_liberty_authority))+
    geom_point(aes(y=Opp_liberty_authority,shape=EuropeSample$Opposition),size=5)+
    geom_ribbon(aes(ymin=Cab_liberty_authority,ymax=Opp_liberty_authority),alpha=0.25)+
    facet_wrap(~ Country)+
    ylab("Parliamentary Opinion\non Scale of GAL (0) to TAN (10)")+
    theme(legend.position="bottom",
          axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+scale_shape_manual(name="Cabinet or Opposition",
                       limits=c("Cabinet", "Opposition"),
                       labels=c("Cabinet", "Opposition"),
                       values=c(16,2))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))

# 
# LibertyAuthorityLine<-ggplot(data=EuropeSample,aes(x=Year),
#                xlab="Year",
#                ylab="Weighted Cabinet, Liberty=0 to Authority=10")+
#     
#     geom_line(aes(y=Cab_liberty_authority),color="red")+
#     geom_point(aes(y=Cab_liberty_authority),shape=16,color="red",size=5)+
#     geom_line(aes(y=Opp_liberty_authority),color="blue")+
#     geom_point(aes(y=Opp_liberty_authority),shape=2,color="blue",size=5)+
#         geom_ribbon(aes(ymin=Cab_liberty_authority,ymax=Opp_liberty_authority),alpha=0.25)+
#     geom_ribbon(aes(ymin=ifelse(Cab_liberty_authority>=Opp_liberty_authority,Cab_liberty_authority,NA),
#                     ymax=ifelse(Cab_liberty_authority>=Opp_liberty_authority,Opp_liberty_authority,NA)),alpha=0.25,fill="red")+
#         geom_ribbon(aes(ymin=ifelse(Cab_liberty_authority<Opp_liberty_authority,Cab_liberty_authority,NA),
#                     ymax=ifelse(Cab_liberty_authority<Opp_liberty_authority,Opp_liberty_authority,NA)),alpha=0.1,fill="blue")+
    # facet_wrap(~ Country)

LibertyAuthorityLine

```


##EU Anti Pro

```{r EU_Anti_Pro, echo=FALSE}
(build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,


    data=EuropeSample,
    x_var="Cab_eu_anti_pro",
    y_var="DefSpendDelt"
    # ,facet_var=NA
    # ,color_var=NA
)+labs(x="Weighted Cabinet, Anti-EU=0 to Pro-EU=10",
       "Overall Defense Spending, Annual Percent Change")
)

(build_plot(chart_geom="Scatter Plot",
    labels_and_colors=Eur_lc,column_key=Eur_ck,


    data=EuropeSample,
    x_var="Cab_eu_anti_pro",
    y_var="EquSpendDelt"
    # ,facet_var=NA
    # ,color_var=NA
)+labs(x="Weighted Cabinet, Anti-EU=0 to Pro-EU=10",
       "Defense Equipment Spending, Annual Percent Change")
)


EUantiProLine<-ggplot(data=EuropeSample,aes(x=Year))+theme_bw()+
    geom_line(aes(y=Cab_eu_anti_pro))+#,color="red")+color=EuropeSample$Cabinet
    geom_point(aes(y=Cab_eu_anti_pro, shape=EuropeSample$Cabinet),size=5)+#shape=16,color="red",,color=EuropeSample$Cabinet
    geom_line(aes(y=Opp_eu_anti_pro))+#,color="blue")+, color=EuropeSample$Opposition
    geom_point(aes(y=Opp_eu_anti_pro,shape=EuropeSample$Opposition),size=5)+#shape=2,color="blue",color=EuropeSample$Opposition
    geom_ribbon(aes(ymin=Cab_eu_anti_pro,ymax=Opp_eu_anti_pro),alpha=0.25)+
    #     geom_ribbon(aes(ymin=ifelse(Cab_eu_anti_pro>=Opp_eu_anti_pro,Cab_eu_anti_pro,NA),
    #                     ymax=ifelse(Cab_eu_anti_pro>=Opp_eu_anti_pro,Opp_eu_anti_pro,NA)),alpha=0.25,fill="red")+
    #         geom_ribbon(aes(ymin=ifelse(Cab_eu_anti_pro<Opp_eu_anti_pro,Cab_eu_anti_pro,NA),
    #                     ymax=ifelse(Cab_eu_anti_pro<Opp_eu_anti_pro,Opp_eu_anti_pro,NA)),alpha=0.1,fill="blue")+
    facet_wrap(~ Country)+
    ylab("Parliamentary Opinion\non Scale of Anti-EU (0) to Pro-EU (10)")+
    theme(legend.position="bottom",
          axis.text.x = element_text(angle = 90, hjust = 1),
          axis.title= element_text(size=9),
          legend.title= element_text(size=8),
          legend.text= element_text(size=8))+scale_shape_manual(name="Cabinet or Opposition",
                       limits=c("Cabinet", "Opposition"),
                       labels=c("Cabinet", "Opposition"),
                       values=c(16,2))+
    scale_x_continuous(breaks=c(2002,2006,2010,2014))


EUantiProLine

```


```{r SamplePercentOfNATOspending}
# path="Data\\"
# 
# lookup.countries <- read.csv(paste(path, "CountryNameStandardize.csv", sep =""), header = TRUE)
# data.nato <- read.csv(paste(path, "SSI_NATO.csv", sep =""), header = TRUE)
#     data.ally <- melt(data.nato, id = "Year", variable.name="Country",value.name="NATOally")
#     colnames(data.ally)[colnames(data.ally)=="year"] <- "Year"
#     data.ally<-StandardizeCountries(data.ally,lookup.countries)
#     NATO.countries<-unique(subset(data.ally,NATOally==1)$Country)
#     
# data.euds <- read.csv(paste(path, "European_Total_Constant_Euros.csv", sep =""), header = TRUE)
#   data.euds<-RenameYearColumns(data.euds)
#     data.euds<-subset(data.euds,select=-c(Region,X2001.2011,X2001.2010,X2001.2013))
#     data.euds <- melt(data.euds, id=c("Country", "Unit.Currency"), variable.name="Year",value.name="DefSpnd")
#     data.euds$DefSpnd <- as.numeric(gsub(",","",str_trim(as.character(data.euds$DefSpnd))))
#     data.euds$Year <- as.integer(as.character(data.euds$Year))
#     data.euds$DefSpnd <- data.euds$DefSpnd*1000000
#     data.euds<-StandardizeCountries(data.euds,lookup.countries)
# 
# unique(data.euds$Country[!data.euds$Country %in% NATO.countries])
# unique(NATO.countries[!NATO.countries %in% unique(data.euds$Country)])
# 
# data.euds.NATO<-subset(data.euds,Year==2014)
# data.euds.NATO<-subset(data.euds.NATO,Country %in% NATO.countries)
# data.euds.NATO$share<-data.euds.NATO$DefSpnd/sum(data.euds.NATO$DefSpnd,na.rm=TRUE)
# #No Albania, but they aren't that big a spender.
# 
# sum(data.euds.NATO$share[data.euds.NATO$Country %in% c("France","Germany","United Kingdom","Italy","Netherlands","Poland",
#                                                      "Portugal","Slovakia","Spain","Turkey")])
# sum(data.euds.NATO$share[data.euds.NATO$Country %in% c("France","Germany","United Kingdom","Italy","Netherlands","Poland",
#                                                      "Portugal","Spain")])
#     
```




```{r HeterogeneityAcrossCountries}
# str(EuropeSample$DefSpend)
# 
# library(gplots)
# 
# plotmeans(log(EquSpend) ~ Country, main="Heterogeineityacross countries", data=DefSpend)
# plotmeans(log(EquSpend) ~ Country, main="Heterogeineityacross countries", data=EquSpend)
# plotmeans(log(OnMspend) ~ Country, main="Heterogeineityacross countries", data=EuropeSample)

# plotmeansdraw a 95% confidence interval around the means
# detach("package:gplots")
# Remove package 'gplots' from the workspace
```