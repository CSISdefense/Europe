---
title: "European Defense and Public Opinion: Selected Models"
author: "Greg Sanders"
date: "October 19, 2015"
output: 
  html_document: 
    keep_md: yes
    toc: yes
---


```{r Setup, echo = FALSE, results = "hide", warning=FALSE, message=FALSE}
options(error=recover)
options(warn=1)

require(Hmisc)
require(texreg)
require(plm)
require(ggplot2)
require(reshape2)
require(plyr)
require(quantmod)

#Your working directory here!
# setwd("K:/Development/Europe") #Your working directory here!
# setwd("C:/Users/Greg Sanders/Documents/Development/Europe")
# setwd("C:/Users/scohen/My Documents/Europe/Git/Europe")

source("EuropeInput.R")
```


**Load and subset the data we want**
```{r Input, echo = FALSE, results = "hide", warning=FALSE, message=FALSE}

EuropeOmnibus <- CompilePubOpDataOmnibus()
EuropeOmnibus <-subset(EuropeOmnibus, Country %in% c("France","Germany","Italy","Netherlands","Poland",
                                                     "Portugal","Slovakia","Spain","Turkey","United Kingdom"))
    
EuropeOmnibus <-subset(EuropeOmnibus, select=-c(Unit.Currency))


panelmodels<-function(selected.formula,
                      source.data,
                      regression.name,
                      dependent.name=NA,
                      include.random=TRUE){
    
    model.df<-data.frame(name=regression.name,
                         dependent.name=dependent.name,
                         ols=I(list(lm(as.formula(selected.formula), 
                                       data = source.data))),
                         pooling=I(list(plm(as.formula(selected.formula), 
                                            data = source.data, model = "pooling"))),
                         between=I(list(plm(as.formula(selected.formula), 
                                            data = source.data, model = "between"))),
                         fd=I(list(plm(as.formula(selected.formula), 
                                       data = source.data, model = "fd"))),
                         within=I(list(plm(as.formula(selected.formula), 
                                           data = source.data, model = "within"))),
                         random=I(ifelse(include.random,
                                         list(plm(as.formula(selected.formula), 
                                                  data = source.data, model = "random")),
                                         NA))
                         
    )
    
    model.df
    
}

```




**load and subset the data we want**
```{r DefSpreadNarrowing, echo = FALSE, results = "hide"}

##load data using function

EuropeOmnibus<-plm.data(EuropeOmnibus, index=c("Country", "Year"))

EquSpread <- subset(EuropeOmnibus, !is.na(EquSpendDelt_lead))
DefSpread <- subset(EuropeOmnibus, !is.na(DefSpendDelt_lead))

Europe_model<-list()
EuropeDef_name<-c()
Europe_model<-list()
EuropeEqu_name<-c()

```


#Hypothesis 1: Public Support for Defense Spending

Hypothesis 1 a: Net public support for more defense spending results in an increase of defense spending.
Hypothesis 1 b: Net public support for more defense spending results in an increase of investment spending.

``` {r Hyp1_Too_Much_Little_Defense, echo = TRUE}
summary(is.na(DefSpread$DefSpread_lag1))

#Model #1 is Defense Spending and Defense Spread
Europe_model<-panelmodels(selected.formula="DefSpendDelt_lead ~ DefSpread_lag1 + GDPpCapDelt",
                              source.data=subset(DefSpread,!is.na(DefSpread_lag1)&
                                                     (!Country %in% c(   "Slovakia"))),
                              regression.name="Too Much/Little & Def",
                             include.random=FALSE)

# summary(Europe_model$ols[[1]])
summary(Europe_model$pooling[[1]])
# summary(Europe_model$between[[1]])
# summary(Europe_model$fd[[1]])
# summary(Europe_model$within[[1]])
# summary(Europe_model$random[[1]])
plot(Europe_model$ols[[1]])
#190, #86, #194,81


#Mode2 #1 is Equipment Spending and Defense Spread
Europe_model<-rbind(
    Europe_model[1,],
    panelmodels(selected.formula="EquSpendDelt ~ DefSpread_lag2 + GDPpCapDelt + left_right_ls_spread",
                              source.data=subset(EquSpread,!is.na(DefSpread_lag2)),
                              regression.name="Too Much/Little & Equ")
)
 
# summary(Europe_model$ols[[2]])
# summary(Europe_model$pooling[[2]])
# summary(Europe_model$between[[2]])
# summary(Europe_model$fd[[2]])
# summary(Europe_model$within[[2]])
summary(Europe_model$random[[2]])
# plot(Europe_model$ols[[2]])
screenreg(list(Europe_model$pooling[[1]],Europe_model$random[[2]]),
          custom.model.name=c(as.character(Europe_model$name[1:2])),
          digits=3,
          stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,4,3,5),
          groups = list("Intercept" = 1,"Polling" = 2:3, "MacroEconomics" = 4,"Parliamentary" = 5)
          )



```

#Hypothesis 2: Public Support for Active European Foreign Policy

Hypothesis 2a: Net public support of individual European countries for a greater presence of the EU in international affairs results in an increase of investment defense spending.
Hypothesis 2b: Net public support of individual European countries for a greater presence of the EU in international affairs results in an increase of investment spending.


``` {r Hyp2_EU_Leadership, echo = TRUE}

#Model #3 is Defense Spending and European Leadership
Europe_model<-rbind(
    Europe_model[1:2,],
    panelmodels(selected.formula="DefSpendDelt ~ EUldrSpread + IntlCnf + GDPpCapDelt +
                                 eu_anti_pro_ls_spread",
                source.data=subset(DefSpread,!is.na(EUldrSpread)),
                regression.name="EU leadership & Change in Def. Top-Line",
                dependent.name="Change in Defense",
                include.random=TRUE)
)

# summary(Europe_model$ols[[3]])
summary(Europe_model$pooling[[3]])
# summary(Europe_model$between[[3]])
# summary(Europe_model$fd[[3]])
# summary(Europe_model$within[[3]])
# summary(Europe_model$random[[3]])
# plot(Europe_model$ols[[3]])
Europe_model<-rbind(
    Europe_model[1:3,],
    panelmodels(selected.formula="EquSpendDelt ~ EUldrSpread_lag1 + CivilWar + Cab_liberty_authority + Cab_eu_anti_pro",
                source.data=subset(EquSpread,!is.na(EUldrSpread_lag1)),
                regression.name="EU leadership & Change in Def. Equipment",
                dependent.name = "Change in Def. Equip.",
                include.random=FALSE)
)
    

#Mode2 #4 is Equipment Spending and European Leadership    
# summary(Europe_model$ols[[4]])
summary(Europe_model$pooling[[4]])
# summary(Europe_model$between[[4]])
# summary(Europe_model$fd[[4]])
# summary(Europe_model$within[[4]])
# summary(Europe_model$random[[4]])
# plot(Europe_model$ols[[4]])





htmlreg(list(Europe_model$pooling[[3]],Europe_model$pooling[[4]]),
          file="Output\\Hypothesis2.html",
          custom.model.name=c(as.character(Europe_model$name[3:4])),
          digits=3,
          stars=c(0.001,0.01,0.05,0.1),
          custom.coef.names = c(NA,  # (Intercept)  
                                "EU Leadership (year T-1)", #EUldrSpread   
                                "Militarized interstate disputes (year T-1)", # IntlCnf 
                                "Change in GDP per Capita (year T-1)", #GDPpCapDelt
                                "EU-Anti-Pro Polarization (year T-1)", #eu_anti_pro_ls_spread 
                                "EU Leadership (year T-2)", #EUldrSpread_lag1
                                "Civil War (year T-21 to T-1)", #CivilWar 
                                "Cabinet Liberty-Authority (year T-1)", #Cab_liberty_authority
                                "Cabinet EU-Anti-Pro (year T-1)"), # Cab_eu_anti_pro   
          reorder.coef=c(2,6,3,7,4,8,9,5,1),
          groups = list("Polling Net Support for" = 1:2, "Security"=3:4, "Macroeconomic" = 5, "Parliamentary"=6:8,"Constant" = 1,)
          )

```

#Hypothesis 3: Public Support for NATO

Hypothesis 3 a: Net public support for believing that NATO is essential to your country's security will increase defense spending. 
Hypothesis 3 b: Net public support for believing that NATO is essential to your country's security will increase defense spending. 
Hypothesis 3 cb: Net public support for believing that NATO is essential to your country's security will increase investment spending.

``` {r Hyp3_NATO, echo = TRUE}


#Model #5 is Defense Spending and NATO EU convergence
Europe_model<-rbind(
    Europe_model[1:4,],
    panelmodels(selected.formula="DefSpendDelt_lead ~ NATO.EUspread_lag1   + GDPpCapDelt + liberty_authority_ls_spread",
                source.data=subset(DefSpread,!is.na(NATO.EUspread_lag1)),
                regression.name="NATO-EU Conv. & Def",
                include.random=FALSE)
)

# summary(Europe_model$ols[[5]])
summary(Europe_model$pooling[[5]])
# summary(Europe_model$between[[5]])
# summary(Europe_model$fd[[5]])
# summary(Europe_model$within[[5]])
# summary(Europe_model$random[[5]])
# plot(Europe_model$ols[[5]])

#Model #6 is Defense Spending and NATO essential
Europe_model<-rbind(
    Europe_model[1:5,],
    panelmodels(selected.formula="DefSpendDelt_lead ~ NATOessSpread_lag2",
                source.data=subset(EquSpread,!is.na(NATOessSpread_lag2)),
                regression.name="NATO Ess. & Def",
                include.random=TRUE)
)

# summary(Europe_model$ols[[6]])
summary(Europe_model$pooling[[6]])
# summary(Europe_model$between[[6]])
# summary(Europe_model$fd[[6]])
# summary(Europe_model$within[[6]])
# summary(Europe_model$random[[6]])

# plot(Europe_model$ols[[6]])


#Model #7 is Equipment Spending and EU NATO  convergence
Europe_model<-rbind(
    Europe_model[1:6,],
    panelmodels(selected.formula="EquSpendDelt_lead ~ NATO.EUspread_lag2  + GDPpCapDelt + eu_anti_pro_ls_spread",
                source.data=subset(EquSpread,!is.na(NATO.EUspread_lag2)),
                regression.name="NATO-EU Conv. & Equ",
                include.random=FALSE)
)
    
    
# summary(Europe_model$ols[[7]])
summary(Europe_model$pooling[[7]])
# summary(Europe_model$between[[7]])
# summary(Europe_model$fd[[7]])
# summary(Europe_model$within[[7]])
# summary(Europe_model$random[[7]])
# plot(Europe_model$ols[[7]])



#Model #8 is Equipment Spending and NATO essential
Europe_model<-rbind(
    Europe_model[1:7,],
    panelmodels(selected.formula="EquSpendDelt_lead ~ NATOessSpread_lag1  + CivilWar",
                source.data=subset(EquSpread,!is.na(NATOessSpread_lag1)),
                regression.name="NATO Ess. & Equ",
                include.random=FALSE)
)


# summary(Europe_model$ols[[8]])
summary(Europe_model$pooling[[8]])
# summary(Europe_model$between[[8]])
# summary(Europe_model$fd[[8]])
# summary(Europe_model$within[[8]])
# summary(Europe_model$random[[8]])
# plot(Europe_model$ols[[8]])



screenreg(list(Europe_model$pooling[[5]],Europe_model$within[[6]],Europe_model$pooling[[7]],Europe_model$pooling[[8]]),
          custom.model.name=c(as.character(Europe_model$name[5:8])),
          digits=4,
          stars=c(0.001,0.01,0.05,0.1),
          custom.coef.names = c(NA,
                                "NATO-EU Convergence (t-2)",
                                NA,# 
                                NA,#"NATO Essential (t-2)",# "Const. GDP Per Cap. % Change (t-1)",
                                "NATO Essential (t-3)",# "EU-Anti-Pro Spread^2 (t-1)",
                                "NATO-EU Convergence (t-3)",# "European Leadership Spread (t-2)",
                                "EU-Anti-Pro Spread^2",# "Civil War (t-21 to t-1)",
                                NA,# "Cabinet Liberty-Authority (t-1)",
                                NA),# "Cabinet EU-Anti-Pro (t-1)"),
          reorder.coef=c(1,2,6,5,8,9,3,4,7),
          groups = list("Intercept" = 1,"Polling" = 2:5, "Security" = 6, "Macroeconomic" = 7, "Parliamentary"=8:9)

          )


```

#Dependent Variable cross-analyses

##All Tests Using Top-Line Defense Spending as a Dependent Variable

```{r DefenseDependent}
screenreg(list(Europe_model$pooling[[1]],Europe_model$pooling[[3]],Europe_model$pooling[[5]],Europe_model$within[[6]]),
          custom.model.name=c(as.character(Europe_model$name[c(1,3,5,6)])),
          digits=4,
          stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,7,2,4,9,5,3,8,6),
          groups = list("Intercept" = 1,"Polling" = 2:5, "Security"=6,"Macroeconomic" = 7, "Parliamentary"=8:9)
          )


```

##All Tests Using Defense Investment Spending as a Dependent Variable

```{r EquipmentDependent}
screenreg(list(Europe_model$random[[2]],Europe_model$pooling[[4]],Europe_model$pooling[[7]],Europe_model$pooling[[8]]),
          custom.model.name=c(as.character(Europe_model$name[c(2,4,7,8)])),
          digits=4,
          stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,5,9,11,6,3,4,7,10,8),
          groups = list("Intercept" = 1,"Polling" = 2:5, "Security"=6,"Macroeconomic" = 7, "Parliamentary"=8:11)
          )

```