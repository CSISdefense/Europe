---
title: "NATO Essential and Equipment Spending"
author: "src"
date: "October 19, 2015"
output:
  html_document:
    toc: yes
---

**Load packages and support files**
```{r Setup, echo = FALSE, results = "hide"}
options(error=recover)
options(warn=1)

require(Hmisc)
require(texreg)
require(plm)
require(ggplot2)
require(reshape2)
require(plyr)
require(quantmod)

#Your working directory here!
# setwd("K:/Development/Europe") #Your working directory here!
# setwd("C:/Users/Greg Sanders/Documents/Development/Europe")
# setwd("C:/Users/scohen/My Documents/Europe/Git/Europe")

source("EuropeInput.R")

```


**Load and subset the data we want**
```{r Input, echo = FALSE, results = "hide"}


# debug(CompilePubOpDataOmnibus)
##load data using function
#undebug(CompilePubOpDataOmnibus)
EuropeOmnibus <- CompilePubOpDataOmnibus()


write.table(EuropeOmnibus
            ,file=paste("data\\EuropeOmnibus.csv"
                        ,sep=""
                        )
            #   ,header=TRUE
            , sep=","
            , row.names=FALSE
            , append=FALSE
            )


#get rid of greece
EuropeOmnibus <- subset(EuropeOmnibus, !Country %in% c("Greece", "Sweden","Russia","United States"))




write.table(EuropeOmnibus
            ,file=paste("data\\EuropeSample.csv"
                        ,sep=""
                        )
            #   ,header=TRUE
            , sep=","
            , row.names=FALSE
            , append=FALSE
            )
##change government spreads from factors



```


**load and subset the data we want**
```{r DefSpreadNarrowing, echo = FALSE, results = "hide"}

##load data using function
EquNATOessSpread <- subset(EuropeOmnibus, !is.na(EquSpendDelt_lead))

EquNATOessSpread_lag0 <- subset(EquNATOessSpread, !is.na(NATOessSpread))
EquNATOessSpread_lag1 <- subset(EquNATOessSpread, !is.na(NATOessSpread_lag1))
EquNATOessSpread_lag2<- subset(EquNATOessSpread, !is.na(NATOessSpread_lag2))

```



``` {r PublicOpinionLag, echo = TRUE}
NATOessEquSpread_model<-list()
NATOessEquSpread_name<-c()

NATOessEquSpread_model[1] <- list(lm(EquSpendDelt_lead ~ NATOessSpread, EquNATOessSpread_lag0) )
NATOessEquSpread_name[1]<-"PubOp_ne1"
screenreg(NATOessEquSpread_model[1],
          custom.model.name=NATOessEquSpread_name[1])
summary(NATOessEquSpread_model[[1]])
plot(NATOessEquSpread_model[[1]])

NATOessEquSpread_model[2] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1, EquNATOessSpread_lag1))
NATOessEquSpread_name[2]<-"PubOp_ne2"
screenreg(NATOessEquSpread_model[c(1:2)],
          custom.model.name=NATOessEquSpread_name[c(1:2)])
summary(NATOessEquSpread_model[[2]])
plot(NATOessEquSpread_model[[2]])

NATOessEquSpread_model[3] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag2, EquNATOessSpread_lag2))
NATOessEquSpread_name[2]<-"PubOp_ne2"
screenreg(NATOessEquSpread_model[c(1:3)],
          custom.model.name=NATOessEquSpread_name[c(1:3)])
summary(NATOessEquSpread_model[[3]])
plot(NATOessEquSpread_model[[3]])


#The two year difference in PubOp_ne2 has the largest coefficient and the smallest p-value.

```

After comparing the three options, the three year difference between expenditure and Nato Essential polling appears to have the strongest relationship, even if it no where close to significant.


``` {r SecurityEnvironment, echo = TRUE}


NATOessEquSpread_model[4] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + IntAt, EquNATOessSpread_lag1))
NATOessEquSpread_name[4]<-"IntAt"
screenreg(NATOessEquSpread_model[c(1:3,4)],
          custom.model.name=NATOessEquSpread_name[c(1:3,4)])
summary(NATOessEquSpread_model[[4]])

#Lowers adjusted R^2 intl attack will not be used.

NATOessEquSpread_model[5] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + DomAt, EquNATOessSpread_lag1))
NATOessEquSpread_name[5]<-"DomAt"
screenreg(NATOessEquSpread_model[c(1:3,5)],
          custom.model.name=NATOessEquSpread_name[c(1:3,5)])
summary(NATOessEquSpread_model[[5]])

# Lower domestic attack R^2, will not use.

NATOessEquSpread_model[6] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + CivilWar, EquNATOessSpread_lag1))
NATOessEquSpread_name[6]<-"CivilWar"
screenreg(NATOessEquSpread_model[c(1:3,6)],
          custom.model.name=NATOessEquSpread_name[c(1:3,6)])
summary(NATOessEquSpread_model[[6]])
summary(EquNATOessSpread_lag1$CivilWar)

#NATO.EU closer  removes Civil war cases 


NATOessEquSpread_model[7] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + IntlCnf, EquNATOessSpread_lag1))
NATOessEquSpread_name[7]<-"IntlCnf"
screenreg(NATOessEquSpread_model[c(1:3,7)],
          custom.model.name=NATOessEquSpread_name[c(1:3,7)])
summary(NATOessEquSpread_model[[7]])
summary(EuropeOmnibus$IntlCnf)

#NATO.EU closer  removes IntlCnf cases 

```

Minimal gains from the security environment variables, and the signs were all in an unexpected direction.


``` {r MacroEconomics, echo = TRUE}


reg<-8
NATOessEquSpread_model[reg] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + GDPpCapDelt, EquNATOessSpread_lag1))
NATOessEquSpread_name[reg]<-"GDPpCapDelt"
screenreg(NATOessEquSpread_model[c(1:3,8,reg)],
          custom.model.name=NATOessEquSpread_name[c(1:3,8,reg)])
summary(NATOessEquSpread_model[[reg]])
plot(NATOessEquSpread_model[[reg]])
#Shrinks adjusted r^2, not significant. Leaving out.



```

Tepted to add GDPpCapDelt which had a sign that made sense and improved p value of the lag, but reduces the adjusted R^2.

``` {r Parliament, echo = TRUE}


reg<-9
NATOessEquSpread_model[reg] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + Cab_left_right, EquNATOessSpread_lag1))
NATOessEquSpread_name[reg]<-"Left_Right"
screenreg(NATOessEquSpread_model[c(1:3,8,reg)],
          custom.model.name=NATOessEquSpread_name[c(1:3,8,reg)])
summary(NATOessEquSpread_model[[reg]])

#Shrinks adjusted r^2, not significant. Leaving out  Dropping Cab_left_right


reg<-10
NATOessEquSpread_model[reg] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + Cab_liberty_authority, EquNATOessSpread_lag1))
NATOessEquSpread_name[reg]<-"Lib_Auth"
screenreg(NATOessEquSpread_model[c(1:3,8,reg)],
          custom.model.name=NATOessEquSpread_name[c(1:3,8,reg)])
summary(NATOessEquSpread_model[[reg]])

#Lower adjusted R^2, not significant and doesn't make sense. Dropping Cab_liberty_authority

reg<-11
NATOessEquSpread_model[reg] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + Cab_eu_anti_pro, EquNATOessSpread_lag1))
NATOessEquSpread_name[reg]<-"EU_anti_pro"
screenreg(NATOessEquSpread_model[c(1:3,8,reg)],
          custom.model.name=NATOessEquSpread_name[c(1:3,8,reg)])
summary(NATOessEquSpread_model[[reg]])
plot(NATOessEquSpread_model[[reg]])
#Slightly lowers p-value, but doesn't raise adjusted R^2, and doesn't help with residuals vs. leverage.


reg<-12
NATOessEquSpread_model[reg] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + left_right_ls_spread, EquNATOessSpread_lag1))
NATOessEquSpread_name[reg]<-"Left_right_dif"
screenreg(NATOessEquSpread_model[c(1:3,8,reg)],
          custom.model.name=NATOessEquSpread_name[c(1:3,8,reg)])
summary(NATOessEquSpread_model[[reg]])
plot(NATOessEquSpread_model[[reg]])
#Small gain, small rise in adjusted R^2, small p-value gain. Throws off scale-location.

reg<-13
NATOessEquSpread_model[reg] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + liberty_authority_ls_spread, EquNATOessSpread_lag1))
NATOessEquSpread_name[reg]<-"la_spread"
screenreg(NATOessEquSpread_model[c(1:3,12,reg)],
          custom.model.name=NATOessEquSpread_name[c(1:3,8,reg)])
summary(NATOessEquSpread_model[[reg]])

#No real change to adjusted R-squared but decreases pvalue of study variable. Leaving out.

reg<-14
NATOessEquSpread_model[reg] <- list(lm(EquSpendDelt_lead ~ NATOessSpread_lag1  + eu_anti_pro_ls_spread, EquNATOessSpread_lag1))
NATOessEquSpread_name[reg]<-"eu_spread"
screenreg(NATOessEquSpread_model[c(1:3,12,13,reg)],
          custom.model.name=NATOessEquSpread_name[c(1:3,8,13,reg)])
summary(NATOessEquSpread_model[[reg]])
plot(NATOessEquSpread_model[[3]])
#Adjusted R^2 steady and lowers the p value on study variable. Seems worth keeping


```

Model #14 is chosen, but is not significant. Not checking interactions because there's no significant variables to check with.


**Tests of within and pooling**

``` {r defspreadPoolingTest, echo = TRUE}

selected<-14
screenreg(NATOessEquSpread_model[c(1:3,8,13,14)],
          custom.model.name=NATOessEquSpread_name[c(1:3,8,13,14)])
summary(NATOessEquSpread_model[[selected]])
plot(NATOessEquSpread_model[[selected]])

pooled<-15
NATOessEquSpread_name[pooled]<-"pooling"
NATOessEquSpread_model[pooled] <- list(plm(EquSpendDelt_lead ~ NATOessSpread_lag1  + eu_anti_pro_ls_spread,
                          data = EquNATOessSpread_lag1, model = "pooling"))
summary(NATOessEquSpread_model[[pooled]])

within<-16
NATOessEquSpread_name[reg]<-"within"
NATOessEquSpread_model[within] <- list(plm(EquSpendDelt_lead ~ NATOessSpread_lag1  + eu_anti_pro_ls_spread,
                          data = EquNATOessSpread_lag1, model = "within"))
summary(NATOessEquSpread_model[[within]])

pFtest(NATOessEquSpread_model[[pooled]],NATOessEquSpread_model[[within]])
##p = NA. Cannot judge the null that the pooling model works (all coefficients for each country should be the same ever year)

```


**Fixed Effects model** (within)
```{r DefSpreadFixed, echo = TRUE}

screenreg(NATOessEquSpread_model[c(selected,within)],
         custom.model.name=NATOessEquSpread_name[c(selected,within)])

#testing for fixed effects
pFtest(NATOessEquSpread_model[[within]], NATOessEquSpread_model[[selected]]
       )

##p = 0.72, cannot reject null hypothesis that there are not significnat effects, use pooled 

```

Unable to perform Hausman test. 

**Compare Fixed effects to random effects** 

``` {r DefSperadHausmanTest, echo = TRUE}

withinindex<-17
NATOessEquSpread_name[withinindex]<-"withinindex"
NATOessEquSpread_model[withinindex] <- list(plm(EquSpendDelt_lead ~ NATOessSpread_lag1  + eu_anti_pro_ls_spread,
                          data = EquNATOessSpread_lag1, index=c("Country", "Year"), model = "within"))
summary(NATOessEquSpread_model[[withinindex]])

screenreg(NATOessEquSpread_model[c(selected,within,withinindex)] ,
          custom.model.name=NATOessEquSpread_name[c(selected,within,withinindex)])


# randomindex<-18
# NATOessEquSpread_model[withinindex] <- list(plm(EquSpendDelt_lead ~ NATOessSpread_lag1  + eu_anti_pro_ls_spread,
#                           data = EquNATOessSpread_lag1, index=c("Country", "Year"), model = "random"))
# summary(NATOessEquSpread_model[[randomindex]])
# 
# Fails: Error in swar(object, data, effect) : 
#   the estimated variance of the individual effect is negative

# screenreg(NATOessEquSpread_model[c(selected,within,withinindex,randomindex)] ,
#           custom.model.name=NATOessEquSpread_name[c(selected,within,withinindex,randomindex)])

# pFtest(NATOessEquSpread_model[[withinindex]], NATOessEquSpread_model[[randomindex]])

##p-value Uncalculated reject null, which makes sense because it told us before to do pooled. 
```

