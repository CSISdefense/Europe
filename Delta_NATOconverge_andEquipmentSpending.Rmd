---
title: "Untitled"
author: "src"
date: "October 19, 2015"
output: html_document
---

**Load packages and support files**
```{r Setup, echo = FALSE, results = "hide"}
options(error=recover)
options(warn=1)

require(Hmisc)
require(texreg)
require(plm)
require(ggplot2)
require(reshape2)
require(plyr)
require(quantmod)

#Your working directory here!
# setwd("K:/Development/Europe") #Your working directory here!
#setwd("C:/Users/Greg Sanders/Documents/Development/Europe")
# setwd("C:/Users/scohen/My Documents/Europe/Git/Europe")

source("EuropeInput.R")

```


**Load and subset the data we want**
```{r Input, echo = FALSE, results = "hide"}


# debug(CompilePubOpDataOmnibus)
##load data using function
#undebug(CompilePubOpDataOmnibus)
EuropeOmnibus <- CompilePubOpDataOmnibus()


write.table(EuropeOmnibus
            ,file=paste("data\\EuropeOmnibus.csv"
                        ,sep=""
                        )
            #   ,header=TRUE
            , sep=","
            , row.names=FALSE
            , append=FALSE
            )


#get rid of greece
EuropeOmnibus <- subset(EuropeOmnibus, !Country %in% c("Greece", "Sweden","Russia","United States"))




write.table(EuropeOmnibus
            ,file=paste("data\\EuropeSample.csv"
                        ,sep=""
                        )
            #   ,header=TRUE
            , sep=","
            , row.names=FALSE
            , append=FALSE
            )
##change government spreads from factors



```


**load and subset the data we want**
```{r DefSpreadNarrowing, echo = FALSE, results = "hide"}

##load data using function
EquNATOessSpread <- subset(EuropeOmnibus, !is.na(EquSpendDelt_lead))

EquNATOessSpread_lag0 <- subset(EquNATOessSpread, !is.na(NATO.EUspread))
EquNATOessSpread_lag1 <- subset(EquNATOessSpread, !is.na(NATO.EUspread_lag1))
EquNATOessSpread_lag2<- subset(EquNATOessSpread, !is.na(NATO.EUspread_lag2))







```



``` {r PublicOpinionLag, echo = TRUE}
NATOessSpreadEqu_model<-list()
NATOessSpreadEqu_name<-c()

NATOessSpreadEqu_model[1] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread, EquNATOessSpread_lag0) )
NATOessSpreadEqu_name[1]<-"PubOp_ne1"
screenreg(NATOessSpreadEqu_model[1],
          custom.NATOessSpreadEqu_name=NATOessSpreadEqu_name[1])
summary(NATOessSpreadEqu_model[[1]])
plot(NATOessSpreadEqu_model[[1]])

NATOessSpreadEqu_model[2] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag1, EquNATOessSpread_lag1))
NATOessSpreadEqu_name[2]<-"PubOp_ne2"
screenreg(NATOessSpreadEqu_model[c(1:2)],
          custom.NATOessSpreadEqu_name=NATOessSpreadEqu_name[c(1:2)])
summary(NATOessSpreadEqu_model[[2]])
plot(NATOessSpreadEqu_model[[2]])

NATOessSpreadEqu_model[3] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[2]<-"PubOp_ne2"
screenreg(NATOessSpreadEqu_model[c(1:3)],
          custom.NATOessSpreadEqu_name=NATOessSpreadEqu_name[c(1:3)])
summary(NATOessSpreadEqu_model[[3]])
plot(NATOessSpreadEqu_model[[3]])


#The two year difference in PubOp_ne2 has the largest coefficient and the smallest p-value.

```

After comparing the three options, the three year difference between expenditure and Nato Essential polling appears to have the strongest relationship, even if it no where close to significant.


``` {r SecurityEnvironment, echo = TRUE}

reg<-4
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + IntAt, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"IntAt"
summary(NATOessSpreadEqu_model[[reg]])

#Lowers adjusted R^2 intl attack will not be used.

reg<-5
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + DomAt, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"DomAt"
summary(NATOessSpreadEqu_model[[reg]])

# Lower domestic attack R^2, will not use.

reg<-6
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + CivilWar, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"CivilWar"
summary(NATOessSpreadEqu_model[[reg]])
summary(EquNATOessSpread_lag2$CivilWar)

#NATOessential removes Civil war cases 

reg<-7
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + IntlCnf, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"IntlCnf"
summary(NATOessSpreadEqu_model[[reg]])
summary(EuropeOmnibus$IntlCnf)

#NATOessential  closer  removes IntlCnf cases 

screenreg(NATOessSpreadEqu_model[c(1:7,reg)],
          custom.NATOessSpreadEqu_name=NATOessSpreadEqu_name[c(1:3,reg)])


```

Minimal gains from the security environment variables, and the signs were all in an unexpected direction.


``` {r MacroEconomics, echo = TRUE}


reg<-8
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + GDPpCapDelt, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"GDPpCapDelt"
summary(NATOessSpreadEqu_model[[reg]])
plot(NATOessSpreadEqu_model[[reg]])
#Shrinks adjusted r^2, not significant. Leaving out.

screenreg(NATOessSpreadEqu_model[c(1:3,reg)],
          custom.NATOessSpreadEqu_name=NATOessSpreadEqu_name[c(1:3,reg)])



```

Added GDPpCapDelt which had a sign that made sense and improved p value of the lag, even if it doesn't help the R^2

``` {r Parliament, echo = TRUE}


reg<-9
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + Cab_left_right, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"Left_Right"
summary(NATOessSpreadEqu_model[[reg]])

#Shrinks adjusted r^2, not significant. Leaving out  Dropping Cab_left_right


reg<-10
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  +  Cab_liberty_authority, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"Lib_Auth"
summary(NATOessSpreadEqu_model[[reg]])

#Lower adjusted R^2, not significant and doesn't make sense. Dropping Cab_liberty_authority

reg<-11
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + Cab_eu_anti_pro, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"EU_anti_pro"
summary(NATOessSpreadEqu_model[[reg]])

#Small rise in R^2. Dropping Cab_eu_anti_pro


reg<-12
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + left_right_ls_spread, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"Left_right_dif"
summary(NATOessSpreadEqu_model[[reg]])

#Small gain in R^2 but no change  in adjusted R^2, small p-value gain. Leaving out

reg<-13
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + GDPpCapDelt + liberty_authority_ls_spread, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"la_spread"
summary(NATOessSpreadEqu_model[[reg]])

#Small gain in R^2 but no change  in adjusted R^2. Leaving out

reg<-14
NATOessSpreadEqu_model[reg] <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2  + GDPpCapDelt + eu_anti_pro_ls_spread, EquNATOessSpread_lag2))
NATOessSpreadEqu_name[reg]<-"eu_spread"
summary(NATOessSpreadEqu_model[[reg]])
plot(NATOessSpreadEqu_model[[reg]])
#Adjusted R^2 steady and lowers the p value on study variable. Seems worth keeping

screenreg(NATOessSpreadEqu_model[c(1:3,9:14)],
          custom.NATOessSpreadEqu_name=NATOessSpreadEqu_name[c(1:3,9:14)])



```

Model #14 is chosen, but is not significant.




**Tests of within and pooling** we should explain this in the 

``` {r defspreadPoolingTest, echo = TRUE}
# 
# EUDefSpreadResults_EUspread <- list(lm(EquSpendDelt_lead ~ NATO.EUspread_lag2 +  IntlCnf + GDPpCapDelt + Cab_liberty_authority+ eu_anti_pro_ls_spread + eu_anti_pro_ls_spread:NATO.EUspread_lag2 , EquNATOessSpread_lag2)
# 
# screenreg(list(NATOessSpreadEqu_model_pubop0,NATOessSpreadEqu_model_pubop1,NATOessSpreadEqu_model_pubop2,EUDefSpreadResults_CivilWar,EUDefSpreadResults_IntlCnf,EUDefSpreadResults_GDPpCapDelt,EUDefSpreadResults_GDPpCapDelt_noCW,EUDefSpreadResults_cablibauth,EUDefSpreadResults_LRspread,EUDefSpreadResults_LAspread),
#            custom.NATOessSpreadEqu_name=c("PubOp_df1","PubOp_ne2","PubOp_df3","CivilWar","IntlCnf","GDPpCapDelt","GnoCW","CabLibAuth",
#                             "lr_spread","la_spread"))
# summary(EUDefSpreadResults_LAspread)
# 
# VariablesInModel=subset(EquNATOessSpread_lag2,select=c(Country,Year,EquSpendDelt_lead , NATO.EUspread_lag2 ,  IntlCnf , GDPpCapDelt , Cab_liberty_authority, eu_anti_pro_ls_spread ),Year>2004)
# VariablesInModel$Country<-as.factor(VariablesInModel$Country)
# summary(VariablesInModel$Country)
# 
# NATOcnvPooled <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2 +  IntlCnf + GDPpCapDelt + Cab_liberty_authority+ eu_anti_pro_ls_spread + eu_anti_pro_ls_spread:NATO.EUspread_lag2, data = VariablesInModel, model = "pooling")
# summary(NATOcnvPooled)
# NATOcnvWithin <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2 +  IntlCnf + GDPpCapDelt + Cab_liberty_authority+ eu_anti_pro_ls_spread + eu_anti_pro_ls_spread:NATO.EUspread_lag2, data = VariablesInModel,  model = "within")
# summary(NATOcnvWithin)
# 
# pFtest(NATOcnvPooled, NATOcnvWithin)
# ##p = .1258 cannot  reject the null that the pooling model works (all coefficients for each country should be the same ever year)

```


**Fixed Effects model** (within)
```{r DefSpreadFixed, echo = TRUE}
# 
# NATOcnvResultsFixed <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2 +  IntlCnf + GDPpCapDelt + Cab_liberty_authority+ eu_anti_pro_ls_spread + eu_anti_pro_ls_spread:NATO.EUspread_lag2, data = VariablesInModel,  model = "within"))
# summary(NATOcnvResultsFixed)
# 
# screenreg(list(EUDefSpreadResults_EUspread, NATOcnvResultsFixed))
# 
# #testing for fixed effects
# # pFtest(EUDefSpreadResultsA, EUDefSpreadResults8)
# 
# ##p = .1358,, cannot reject null hypothesis that there are not significnat effects, use pooled 

```

**Compare Fixed effects to random effects** Hausman test. null hypothesist that RE model is true, alternative = fixed effects model
``` {r DefSperadHausmanTest, echo = TRUE}

# NATOessSpreadEqu_modelWithin <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2 +  IntlCnf + GDPpCapDelt + Cab_liberty_authority+ eu_anti_pro_ls_spread + eu_anti_pro_ls_spread:NATO.EUspread_lag2, data = VariablesInModel,  index=c("Country", "Year"), model="within"))
# 
# NATOessSpreadEqu_modelRandom <- list(plm(EquSpendDelt_lead ~ NATO.EUspread_lag2 +  IntlCnf + GDPpCapDelt + Cab_liberty_authority+ eu_anti_pro_ls_spread + eu_anti_pro_ls_spread:NATO.EUspread_lag2, data = VariablesInModel,  index=c("Country", "Year"), model="random"))
# 
# phtest(NATOessSpreadEqu_modelWithin, NATOessSpreadEqu_modelRandom)
# ##p .7333 cannot reject null, which makes sense because it told us before to do pooled. 
```

