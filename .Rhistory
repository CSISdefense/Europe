require(ggplot2)
require(reshape2)
require(plyr)
require(quantmod)
#Your working directory here!
# setwd("K:/Development/Europe") #Your working directory here!
# setwd("C:/Users/Greg Sanders/Documents/Development/Europe")
# #setwd("C:/Users/scohen/My Documents/Europe/Git/Europe")
source("EuropeInput.R")
# Chunk 2: Input
EuropeOmnibus <- CompilePubOpDataOmnibus
# EuropeOmnibus <-subset(EuropeOmnibus, select=-c(Euro))
EuropeOmnibus<-plm.data(EuropeOmnibus, index=c("Country", "Year"))
subset(EuropeOmnibus, !is.na(DefSpend_lead) & (!is.na(DefSpread_lag1)|
!is.na(EUldrSpread_lag1)|
!is.na(NATOessSpread_lag1)|
!is.na(EUcloserUSspread_lag1)))
# Chunk 1: Setup
options(error=recover)
options(warn=1)
require(Hmisc)
require(texreg)
require(plm)
require(ggplot2)
require(reshape2)
require(plyr)
require(quantmod)
#Your working directory here!
# setwd("K:/Development/Europe") #Your working directory here!
# setwd("C:/Users/Greg Sanders/Documents/Development/Europe")
# #setwd("C:/Users/scohen/My Documents/Europe/Git/Europe")
source("EuropeInput.R")
# Chunk 2: Input
EuropeOmnibus <- CompilePubOpDataOmnibus(path="Data//")
# EuropeOmnibus <-subset(EuropeOmnibus, select=-c(Euro))
EuropeOmnibus<-plm.data(EuropeOmnibus, index=c("Country", "Year"))
panelmodels<-function(selected.formula,
source.data,
regression.name,
dependent.name=NA,
independent.name=NA,
include.random=TRUE){
model.df<-data.frame(name=regression.name,
dependent.name=dependent.name,
independent.name=independent.name,
ols=I(list(lm(as.formula(selected.formula),
data = source.data))),
fixed=I(list(plm(as.formula(selected.formula),
data = source.data,
model = "within"))),
fixed.time=I(list(plm(as.formula(paste(selected.formula,"+ factor(Year)")),
data =  source.data,
model = "within"))),
random=I(ifelse(include.random,
list(plm(as.formula(selected.formula),
data =  source.data,
model = "random")),
NA))
)
model.df
}
# Chunk 3: DatasetNarrowing
EuropeOmnibus <-subset(EuropeOmnibus, Country %in% c("France","Germany","United Kingdom",
"Italy","Netherlands","Poland",
"Portugal","Slovakia","Spain","Turkey"))
#Limit data to those cases where both the dependent and independent variables are present
EuropeMoreDef <- subset(EuropeOmnibus, !is.na(DefSpend_lead) & !is.na(EquSpend_lead) &
!is.na(OnMspend_lead) & !is.na(DefSpread_lag1))
EuropeEUleadership <- subset(EuropeOmnibus, !is.na(DefSpend_lead) &
!is.na(EquSpend_lead) & !is.na(OnMspend_lead) &
!is.na(EUldrSpread_lag1) & Country != "Turkey")
EuropeNATOess <- subset(EuropeOmnibus,  !is.na(DefSpend_lead) &
!is.na(EquSpend_lead) & !is.na(OnMspend_lead) &
!is.na(NATOessSpread_lag1))
EuropeEUcloserUS <- subset(EuropeOmnibus, !is.na(DefSpend_lead) &
!is.na(EquSpend_lead) & !is.na(OnMspend_lead) &
!is.na(EUcloserUSspread_lag1) & Country != "Turkey")
EuropeOmnibus<- subset(EuropeOmnibus, !is.na(DefSpend_lead) & (!is.na(DefSpread_lag1)|
!is.na(EUldrSpread_lag1)|
!is.na(NATOessSpread_lag1)|
!is.na(EUcloserUSspread_lag1)))
EuropeModel<-list()
Controls<-"+ log(NGDP_eu2014)+
EUdebt_NGDP+Dfc_NGDP+
+IntAt+UNmilitaryPMil+
Cab_liberty_authority+liberty_authority_ls_spread+
Cab_eu_anti_pro"
# Chunk 4: Hyp1_Too_Much_Little_Defense
#Model 1: Total Defense and More/Less Defense Spending
EuropeModel<-panelmodels(selected.formula=paste("log(DefSpend_lead) ~ DefSpread_lag1",Controls),
source.data=EuropeMoreDef,
regression.name="Too Much/Little Def. Spending & Total Defense",
dependent.name="Total Defense",
independent.name="Defense More/Less",
include.random=FALSE)
summary(EuropeModel$fixed[[1]])
# plot(EuropeModel$ols[[1]])
#190, #86, #194,81
#Model #2 is Equipment Spending and Defense Spread
EuropeModel<-rbind(
EuropeModel[1,],
EuropeModel<-panelmodels(selected.formula=paste("log(EquSpend_lead) ~ DefSpread_lag1",Controls),
source.data=EuropeMoreDef,
regression.name="Too Much/Little Def. Spending & Def. Equipment",
dependent.name="Defense Equipment",
independent.name="Defense More/Less",
include.random=FALSE)
)
summary(EuropeModel$fixed[[2]])
# plot(EuropeModel$ols[[1]])
#190, #86, #194,81
#Model #3 is Equipment Spending and Defense Spread
EuropeModel<-rbind(
EuropeModel[1:2,],
EuropeModel<-panelmodels(selected.formula=paste("log(OnMspend_lead) ~ DefSpread_lag1",Controls),
source.data=EuropeMoreDef,
regression.name="Too Much/Little Def. Spending & Def. O&M/Other",
dependent.name="Defense O&M/Other",
independent.name="Defense More/Less",
include.random=FALSE)
)
summary(EuropeModel$fixed[[3]])
# plot(EuropeModel$ols[[1]])
#190, #86, #194,81
htmlreg(list(EuropeModel$fixed[[1]],EuropeModel$fixed[[2]],EuropeModel$fixed[[3]]),
file="Output\\Hypothesis1.html",
custom.model.name=c(as.character(EuropeModel$name[1:3])),
digits=3,
stars=c(0.001,0.01,0.05,0.1),
custom.coef.names = c("Too Much/Little Def. Spending",#Dlog(NGDPPC_eu2014)
"Log GDP in 2014 Euros", #log(NGDP_eu2014)
"EU27-wide Debt as a percent of GDP",# EUdebt_NGDP
"Deficit a percent of GDP",# Dfc_NGDP
"International Terrorism", #IntAt
"Log of Global Civil War Deaths", # log(GCivilWarBRD)
"Cabinet Liberty/Authority Balance", #Cab_liberty_authority
"Liberty/Authority Polorization", #liberty_authority_ls_spread
"Cabinet Anti/Pro EU"), #Cab_liberty_authority)
groups = list("Polling (year T-2)" = 1,"MacroEconomics (year T-1)" = 2:4,"Security (year T-1)" = 5:6,"Parliamentary (year T-1)" = 7:9),
custom.note="%stars.",
bold=0.05
)
# "Debt as a percent of GDP",# Debt_NGDP
#                               "UN Mission supporting troops and experts, per million",# UNmilitaryPMil
# Chunk 5: Hyp2_EU_Leadership
#Model 4: Total Defense and EU Leadership
EuropeModel<-rbind(
EuropeModel[1:3,],
panelmodels(selected.formula=paste("log(DefSpend_lead) ~ EUldrSpread_lag1",Controls),
source.data=EuropeEUleadership,
regression.name="EU Leadership & Total Defense",
dependent.name="Total Defense",
independent.name="EU Leadership",
include.random=FALSE)
)
summary(EuropeModel$fixed[[4]])
# plot(EuropeModel$ols[[4]])
# summary(EuropeModel$ols[[4]])
#Model #5 is Equipment Spending and European Leadership
EuropeModel<-rbind(
EuropeModel[1:4,],
EuropeModel<-panelmodels(selected.formula=paste("log(EquSpend_lead) ~ EUldrSpread_lag1",Controls),
source.data=EuropeEUleadership,
regression.name="EU leadership & Def. Equipment",
dependent.name="Defense Equipment",
independent.name="EU leadership",
include.random=FALSE)
)
#Model #5 is Equipment Spending and European Leadership
summary(EuropeModel$fixed[[5]])
# plot(EuropeModel$ols[[4]])
#Model #6 is O&M/Other Spending and Defense Spread
EuropeModel<-rbind(
EuropeModel[1:5,],
EuropeModel<-panelmodels(selected.formula=paste("log(OnMspend_lead) ~ EUldrSpread_lag1",Controls),
source.data=EuropeEUleadership,
regression.name="EU leadership & Def. O&M/Other",
dependent.name="Defense O&M/Other",
independent.name="EU leadership",
include.random=FALSE)
)
summary(EuropeModel$fixed[[6]])
# plot(EuropeModel$ols[[1]])
#190, #86, #194,81
htmlreg(list(EuropeModel$fixed[[4]],EuropeModel$fixed[[5]],EuropeModel$fixed[[6]]),
file="Output\\Hypothesis2.html",
custom.model.name=c(as.character(EuropeModel$name[4:6])),
digits=3,
stars=c(0.001,0.01,0.05,0.1),
custom.coef.names = c("EU Leadership",#Dlog(NGDPPC_eu2014)
"Log GDP in 2014 Euros", #log(NGDP_eu2014)
"EU27-wide Debt as a percent of GDP",# EUdebt_NGDP
"Deficit a percent of GDP",# Dfc_NGDP
"International Terrorism", #IntAt
"Log of Global Civil War Deaths", # log(GCivilWarBRD)
"Cabinet Liberty/Authority Balance", #Cab_liberty_authority
"Liberty/Authority Polorization", #liberty_authority_ls_spread
"Cabinet Anti/Pro EU"), #Cab_liberty_authority)
groups = list("Polling (year T-2)" = 1,"MacroEconomics (year T-1)" = 2:4,"Security (year T-1)" = 5:6,"Parliamentary (year T-1)" = 7:9),          custom.note="%stars.",
bold=0.05
)
# Chunk 6: Hyp3_Transatlantic
#Model 7: Total Defense and NATO Essential
EuropeModel<-rbind(
EuropeModel[1:6,],
panelmodels(selected.formula=paste("log(DefSpend_lead) ~ NATOessSpread_lag1",Controls),
source.data=EuropeNATOess,
regression.name="NATO Essential & Total Defense",
dependent.name="Total Defense",
independent.name="NATO Essential",
include.random=FALSE)
)
summary(EuropeModel$fixed[[7]])
# plot(EuropeModel$ols[[7]])
#Model 8: Defense Equipment and NATO Essential
EuropeModel<-rbind(
EuropeModel[1:7,],
panelmodels(selected.formula=paste("log(EquSpend_lead) ~ NATOessSpread_lag1",Controls),
source.data=EuropeNATOess,
regression.name="NATO Essential & Defense Equipment",
dependent.name="Defense Equipment",
independent.name="NATO Essential",
include.random=TRUE)
)
summary(EuropeModel$fixed[[8]])
# plot(EuropeModel$ols[[8]])
#Model #    9 is Defense O&M/Other and NATO essential
EuropeModel<-rbind(
EuropeModel[1:8,],
EuropeModel<-panelmodels(selected.formula=paste("log(OnMspend_lead) ~ NATOessSpread_lag1",Controls),
source.data=EuropeNATOess,
regression.name="NATO Essential & Def. O&M/Other",
dependent.name="Defense O&M/Other",
independent.name="NATO Essential",
include.random=FALSE)
)
summary(EuropeModel$fixed[[9]])
# plot(EuropeModel$ols[[9]])
#Model 10: Total Defense and EU closer to US
EuropeModel<-rbind(
EuropeModel[1:9,],
panelmodels(selected.formula=paste("log(DefSpend_lead) ~ EUcloserUSspread_lag1",Controls),
source.data=EuropeEUcloserUS,
regression.name="EU closer to US & Total Defense",
dependent.name="Defense O&M/Other",
independent.name="EU closer to US",
include.random=FALSE)
)
summary(EuropeModel$fixed[[10]])
# plot(EuropeModel$ols[[10]])
#Model 11: Defense Equipment and EU closer to US
EuropeModel<-rbind(
EuropeModel[1:10,],
panelmodels(selected.formula=paste("log(EquSpend_lead) ~ EUcloserUSspread_lag1",Controls),
source.data=EuropeEUcloserUS,
regression.name="EU closer to US & Defense Equipment",
dependent.name="Defense Equipment",
independent.name="EU closer to US",
include.random=FALSE)
)
summary(EuropeModel$fixed[[11]])
# plot(EuropeModel$ols[[11]])
#Model # 12 Defense O&M/Other and EU closer to US
EuropeModel<-rbind(
EuropeModel[1:11,],
EuropeModel<-panelmodels(selected.formula=paste("log(OnMspend_lead) ~ EUcloserUSspread_lag1",Controls),
source.data=EuropeEUcloserUS,
regression.name="EU closer to US & Def. O&M/Other",
dependent.name="Defense O&M/Other",
independent.name="EU closer to US",
include.random=FALSE)
)
summary(EuropeModel$fixed[[12]])
# plot(EuropeModel$ols[[12]])
htmlreg(list(EuropeModel$fixed[[7]],EuropeModel$fixed[[8]],EuropeModel$fixed[[9]],
EuropeModel$fixed[[10]],EuropeModel$fixed[[11]],EuropeModel$fixed[[12]]),
file="Output\\Hypothesis3.html",
custom.model.name=c(as.character(EuropeModel$name[7:12])),
digits=3,
stars=c(0.001,0.01,0.05,0.1),
#         custom.coef.names = c("NATO Essential",#Dlog(NGDPPC_eu2014)#   NATOessSpread_lag1
#                               "EU, US Closer",#Dlog(NGDPPC_eu2014)#EUcloserUSspread_lag1
# "Log GDP in 2014 Euros", #log(NGDP_eu2014)
# "EU27-wide Debt as a percent of GDP",# EUdebt_NGDP
# "Deficit a percent of GDP",# Dfc_NGDP
# "International Terrorism", #IntAt
# "Log of Global Civil War Deaths", # log(GCivilWarBRD)
# "Cabinet Liberty/Authority Balance", #Cab_liberty_authority
# "Liberty/Authority Polorization", #liberty_authority_ls_spread
# "Cabinet Anti/Pro EU"), #Cab_liberty_authority)
reorder.coef=c(1,10,2,3,4,5,6,7,8,9),
# groups = list("Polling (year T-2)" = 1,"MacroEconomics (year T-1)" = 2:4,"Security (year T-1)" = 5:6,"Parliamentary (year T-1)" = 7:9),          custom.note="%stars.",
# groups = list("Polling (year T-2)" = 1:2,"MacroEconomics (year T-1)" = 3:7,"Security (year T-1)" = 8:10,"Parliamentary (year T-1)" = 11:13),
custom.note="%stars.",
bold=0.05
)
# Chunk 7: DefenseDependent
screenreg(list(EuropeModel$fixed[[1]],EuropeModel$fixed[[4]],EuropeModel$fixed[[7]],EuropeModel$fixed[[10]]),
custom.model.name=c(as.character(EuropeModel$name[c(1,4,7,10)])),
digits=4,
stars=c(0.001,0.01,0.05,0.1),
reorder.coef=c(1,10,11,12,2,3,4,5,6,7,8,9),
groups = list("Polling" = 1:4, "Macroeconomic" = 5:7, "Security" = 8: 9, "Parliamentary"=10:12)
)
# Chunk 8: EquipmentDependent
screenreg(list(EuropeModel$fixed[[2]],EuropeModel$fixed[[5]],EuropeModel$fixed[[8]],EuropeModel$fixed[[11]]),
custom.model.name=c(as.character(EuropeModel$name[c(2,5,8,11)])),
digits=4,
stars=c(0.001,0.01,0.05,0.1),
reorder.coef=c(1,10,11,12,2,3,4,5,6,7,8,9),
groups = list("Polling" = 1:4, "Macroeconomic" = 5:7, "Security" = 8: 9, "Parliamentary"=10:12)
)
# Chunk 9: OnMdependent
screenreg(list(EuropeModel$fixed[[3]],EuropeModel$fixed[[6]],EuropeModel$fixed[[9]],EuropeModel$fixed[[12]]),
custom.model.name=c(as.character(EuropeModel$name[c(3,6,9,12)])),
digits=4,
stars=c(0.001,0.01,0.05,0.1),
reorder.coef=c(1,10,11,12,2,3,4,5,6,7,8,9),
groups = list("Polling" = 1:4, "Macroeconomic" = 5:7, "Security" = 8: 9, "Parliamentary"=10:12)
)
library(gplots)
install.packages("gplots")
library(readxl)
d<-read_xls(file.path("Data_Raw","defence-data-2021.xlsx"))
d<-read_excel(file.path("Data_Raw","defence-data-2021.xlsx"))
?read_excel
eda_file<-file.path("Data_Raw","defence-data-2021.xlsx")
t<-excel_sheets(f)
f<-file.path("Data_Raw","defence-data-2021.xlsx")
t<-excel_sheets(f)
tabs<-excel_sheets(f)
for (t in tabs ){
d<-read_excel(f,sheet = t)
}
f<-file.path("Data_Raw","defence-data-2021.xlsx")
tabs<-excel_sheets(f)
d<-null
source("~/.active-rstudio-document", echo=TRUE)
View(d)
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t)
colnames(d)[1]<-"Row"
d$CountryName<-t
eda<-rbind(eda,d)
}
View(eda)
?read_excel
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
eda<-rbind(eda,d)
}
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
eda<-rbind(eda,d)
}
View(eda)
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","":" - not available")]
eda<-rbind(eda,d)
}
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","":" - not available"),]
eda<-rbind(eda,d)
}
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:",""":"" - not available"),]
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","\:\" - not available"),]
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","\":\" - not available"),]
eda<-rbind(eda,d)
}
View(eda)
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","\":\" - not available","Values"),]
eda<-rbind(eda,d)
}
View(eda)
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","\":\" - not available","Values",t),]
eda<-rbind(eda,d)
}
View(eda)
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","\":\" - not available","Values",t) & !is.na(d$Row),]
eda<-rbind(eda,d)
}
View(eda)
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","\":\" - not available","Values","Notes:",t) & !is.na(d$Row),]
eda<-rbind(eda,d)
}
library(tidyverse)
eda %>% pivot_wider(id_cols=c(Row, CountryName))
eda %>% pivot_longer(id_cols=c(Row, CountryName))
eda %>% pivot_longer(id_cols=c("Row", "CountryName"))
eda %>% pivot_longer(cols=c("Row", "CountryName"))
?pivot_longer
eda %>% pivot_longer(cols=colnames(eda)[!colnames(eda) %in% c("Row", "CountryName")])
eda<-eda %>% pivot_longer(cols=colnames(eda)[!colnames(eda) %in% c("Row", "CountryName")])
View(eda)
eda<-eda %>% pivot_wider(id_cols = "Row")
?pivot_wider
eda<-eda %>% pivot_wider(id_cols = "CountryName",names_from = Row)
eda<-eda %>% pivot_wider(id_cols = "CountryName",names_from = "Row")
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","\":\" - not available","Values","Notes:",t) & !is.na(d$Row),]
eda<-rbind(eda,d)
}
colnames(eda)[!colnames(eda) %in% c("Row", "CountryName")]
data_cols<-colnames(eda)[!colnames(eda) %in% c("Row", "CountryName")]
eda<-eda %>% pivot_longer(cols=data_cols)
View(eda)
eda_long<-eda %>% pivot_wider(id_cols = "CountryName",names_from = "Row")
View(eda_long)
eda<-eda %>% pivot_longer(cols=data_cols,names_to = "Year")
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d<-d[!d$Row %in% c("Symbols:","\":\" - not available","Values","Notes:",t) & !is.na(d$Row),]
eda<-rbind(eda,d)
}
data_cols<-colnames(eda)[!colnames(eda) %in% c("Row", "CountryName")]
eda<-eda %>% pivot_longer(cols=data_cols,names_to = "Year")
eda_long<-eda %>% pivot_wider(id_cols = c(CountryName,Year),names_from = "Row")
View(eda_long)
colnames(eda_long)
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d$PartialCollaborative<-FALSE
if(c("Since 2012, collaborative expenditure data are partial as some Member States are not able to provide the data.",
"Collaborative expenditure data are partial.") %in% d$Row)
d$PartialCollaborative<-TRUE
d<-d[!d$Row %in% c("Symbols:","\":\" - not available","Values","Notes:",t,
"Since 2012, collaborative expenditure data are partial as some Member States are not able to provide the data.",
"Collaborative expenditure data are partial.") & !is.na(d$Row),]
eda<-rbind(eda,d)
}
eda<-data.frame()
for (t in tabs ){
d<-read_excel(f,sheet = t,na=":")
colnames(d)[1]<-"Row"
d$CountryName<-t
d$PartialCollaborative<-FALSE
if("Since 2012, collaborative expenditure data are partial as some Member States are not able to provide the data." %in% d$Row |
"Collaborative expenditure data are partial." %in% d$Row)
d$PartialCollaborative<-TRUE
d<-d[!d$Row %in% c("Symbols:","\":\" - not available","Values","Notes:",t,
"Since 2012, collaborative expenditure data are partial as some Member States are not able to provide the data.",
"Collaborative expenditure data are partial.") & !is.na(d$Row),]
eda<-rbind(eda,d)
}
data_cols<-colnames(eda)[!colnames(eda) %in% c("Row", "CountryName","PartialCollaborative")]
eda<-eda %>% pivot_longer(cols=data_cols,names_to = "Year")
eda_long<-eda %>% pivot_wider(id_cols = c(CountryName,Year,PartialCollaborative),names_from = "Row")
View(eda_long)
save(eda,file=file.path("data","clean","EDA.rda"))
rm(eda_long)
save(eda,file=file.path("data","clean","EDA.rda"))
write.csv(eda,file=file.path("data","clean","EDA.csv"))
save(eda,file=file.path("..","FMS","data","clean","EDA.rda"))
