---
title: "Stepwise Regression Building European Public Opinion and Defense Spending"
author: "Greg Sanders and Samantha Cohen"
date: "June 17, 2016"
output: 
  html_document: 
    number_sections: yes
    toc: yes
---

#Setup
##Load Packages and Support Files
```{r Setup, echo = FALSE, results = "hide"}
options(error=recover)
options(warn=1)
# ```{r set-options, echo=FALSE, cache=FALSE}
options(width = 1000)

require(Hmisc)
require(texreg)
require(plm)
require(ggplot2)
require(reshape2)
require(plyr)
require(quantmod)

#Your working directory here!
# setwd("K:/Development/Europe") #Your working directory here!
# setwd("C:/Users/Greg Sanders/Documents/Development/Europe")
 # #setwd("C:/Users/scohen/My Documents/Europe/Git/Europe")

source("EuropeInput.R")

```


##Load the Data
```{r Input, echo = FALSE, results = "hide"}

# debug(CompilePubOpDataOmnibus)
##load data using function
#undebug(CompilePubOpDataOmnibus)
EuropeOmnibus <- CompilePubOpDataOmnibus()
EuropeOmnibus<-plm.data(EuropeOmnibus, index=c("Country", "Year"))

write.table(EuropeOmnibus
            ,file=paste("data\\EuropeOmnibus.csv"
                        ,sep=""
                        )
            #   ,header=TRUE
            , sep=","
            , row.names=FALSE
            , append=FALSE
            )

```


##Subset the Data

```{r NarrowToSample, echo = FALSE, results = "hide"}

#Subset to countries with more complete time series (excludes Greece and Serbia)
EuropeOmnibus <- subset(EuropeOmnibus, Country %in% c("France","Germany",
                                                      "United Kingdom","Italy",
                                                      "Netherlands","Poland",
                                                     "Portugal","Slovakia",
                                                     "Spain","Turkey"))


write.table(EuropeOmnibus
            ,file=paste("data\\EuropeSample.csv"
                        ,sep=""
                        )
            #   ,header=TRUE
            , sep=","
            , row.names=FALSE
            , append=FALSE
            )

#Limit data to those cases where both the dependent and independent variables are present
EuropeMoreDef <- subset(EuropeOmnibus, !is.na(DefSpend_lead) & !is.na(DefSpread_lag1))
EuropeEUleadership <- subset(EuropeOmnibus, !is.na(DefSpend_lead) & !is.na(EUldrSpread_lag1) & Country != "Turkey")
EuropeNATOess <- subset(EuropeOmnibus, !is.na(DefSpend_lead) & !is.na(NATOessSpread_lag1))
EuropeEUcloserUS <- subset(EuropeOmnibus, !is.na(DefSpend_lead) & !is.na(EUcloserUSspread_lag1) & Country != "Turkey")
EuropeOmnibus<- subset(EuropeOmnibus, !is.na(DefSpend_lead) & (!is.na(EUcloserUSspread_lag1)|
                                                               !is.na(EUldrSpread_lag1)|
                                                                   !is.na(NATOessSpread_lag1)|
                                                                   !is.na(EUcloserUSspread_lag1)))

```

The samples for the two hypotheses that involve courses that the EU should pursue exclude Turkey, which is not yet a member nation. Poland and Slovakia both joined in 2004 and the question was only asked of their populaces after they joined. This question has a different mean for non-members, because it does not necessarily reflect and desired direction for their own country. All the sample countries are NATO members, so none need be excluded from NATO essential. 

#Building the regression model

##Starting with Public Opinion model


``` {r PublicOpinionOnly, echo = TRUE}
corrdisp<-rcorr(as.matrix(subset(EuropeOmnibus, select=c(DefSpread_lag1,
                                               EUldrSpread_lag1,
                                               NATOessSpread_lag1,
                                               EUcloserUSspread_lag1))))
corrdisp[[1]][,1:4]


PollingScatter <- melt(EuropeOmnibus, measure.vars = c("DefSpread_lag1",
                                           "EUldrSpread_lag1",
                                           "EUcloserUSspread_lag1",
                                           "NATOessSpread_lag1"))

 
    ggplot(data=PollingScatter,aes(x=value,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+
        facet_wrap(~variable)+geom_point()+stat_smooth(method = "lm", col = "green") 

lmMoreDef<-list()
lmEUldr<-list()
lmNATOess<-list()
lmEU_UScls<-list()
nModel<-c()

reg<-1
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1, EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1, EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1, EuropeOmnibus))
nModel[reg]<-"PubOp"


screenreg(c(lmMoreDef[1],
               lmEUldr[1],
               lmNATOess[1],
               lmEU_UScls[1]),
               custom.model.names=c(rep(nModel[1],4)),
          stars=c(0.001,0.01,0.05,0.1),
          # reorder.coef=c(1,2,5,9,11,6,3,4,7,10,8),
          groups = list("Intercept" = 1,"Polling" = 2:5))
                        # , "Security"=6,"Macroeconomic" = 7, "Parliamentary"=8:11))
               





```

Relationships do appear in the scatter plots for Defense Spread and EU closer to US. Those plots use the percent change in defense spending as a dependent variable, which resembles the way to interpret the meaning of a change in log, but they make it easier for humans to interpret. The next step is to move to the macroeconomic variables. These will capture much of the explaination for differences in defense spending, as military spending for NATO countries do tend to cluster somewhere beneath the 2 percent mark and thus are correlated to the size of the overall economy.

##Macroeconomic Controls

###Magnitude of the Economy
``` {r MacroMagnitude, echo = TRUE}

corrdisp<-rcorr(as.matrix(subset(EuropeOmnibus, select=c(DefSpread_lag1,
                                               EUldrSpread_lag1,
                                               NATOessSpread_lag1,
                                               EUcloserUSspread_lag1,
                                               NGDP_eu2014, 
                                               NGDPPC_eu2014, 
                                               Population, 
                                               GGR_eu2014))))
corrdisp[[1]][,5:8]

MagnitudeScatter <- melt(EuropeOmnibus, measure.vars = c("NGDP_eu2014Delt",
                                           "NGDPPC_eu2014Delt",
                                           "PopulationDelt",
                                           "GGR_eu2014Delt"))

 
    ggplot(data=MagnitudeScatter,aes(x=value,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+
        facet_grid(~variable,scale="free_x")+geom_point()+stat_smooth(method = "lm", col = "green") 

    
    
reg<-2
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDP_eu2014), EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDP_eu2014), EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDP_eu2014), EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1 + log(NGDP_eu2014), EuropeOmnibus))
nModel[reg]<-"GDP"
reg<-3
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population), EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population), EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population), EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1 + log(NGDPPC_eu2014)+
                            log(Population), EuropeEUcloserUS))
nModel[reg]<-"GDP/pop"
reg<-4
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(GGR_eu2014), EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(GGR_eu2014), EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(GGR_eu2014), EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1 + log(GGR_eu2014), EuropeEUcloserUS))
nModel[reg]<-"GGR"

screenreg(c(lmMoreDef[2:4],
               lmEUldr[2:4]
               ),
               custom.model.names=c(rep(nModel[2:4],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,7,3,4,5,6),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:7))


screenreg(c(lmNATOess[2:4],
               lmEU_UScls[2:4]),
               custom.model.names=c(rep(nModel[2:4],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,7,3,4,5,6),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:7))
                        
               

```

Including both real Euro GDP per Capita and population appears to be a clear winner, with lower RMSE, higher adjusted R^2, and more significant study variables. Population and GDP per capita have a correlation of 0.27, which does not present problems. Including GDP or GGR along with GDP per capita would unsurprisingly introduce correlation problems, so they will be left out.

###Government Debt, Deficit / Surplus

``` {r Debt, echo = TRUE}

corrdisp<-rcorr(as.matrix(subset(EuropeOmnibus, select=c(DefSpread_lag1,
                                               EUldrSpread_lag1,
                                               NATOessSpread_lag1,
                                               EUcloserUSspread_lag1,
                                               NGDPPC_eu2014, 
                                               Population, 
                                               Debt_NGDP,
                                               EUdebt_NGDP
                                               ))))


corrdisp[[1]][,7:8]

DebtScatter <- melt(EuropeOmnibus, measure.vars = c("Debt_NGDP",
                                           "EUdebt_NGDP"))



    ggplot(data=DebtScatter,aes(x=value,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+
        facet_wrap(~variable)+geom_point()+stat_smooth(method = "lm", col = "green")


        
reg<-5
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP, EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP, EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP, EuropeEUcloserUS))
nModel[reg]<-"GGXWDG"

reg<-6
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP, EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP, EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP, EuropeEUcloserUS))
nModel[reg]<-"+EUdebt_NGDP"

screenreg(c(lmMoreDef[c(3,5:6)],
               lmEUldr[c(3,5:6)]),
               custom.model.names=c(rep(nModel[c(3,5:6)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,7,3,4,5,6),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:7))
                        # , "Security"=6,, "Parliamentary"=8:11))



screenreg(c(lmNATOess[c(3,5:6)],
               lmEU_UScls[c(3,5:6)]),
               custom.model.names=c(rep(nModel[c(3,5:6)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,7,3,4,5,6),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:7))
                        # , "Security"=6,, "Parliamentary"=8:11))
              

```

Country level debt is not significant, though EU27 debt levels are. That series potentially captures a temporal dynamic that would otherwise need to be captured by dummy variables. The model will keep both as country level debt provides important context and does not correlate with EU level.

``` {r MacroBalance, echo = TRUE}

corrdisp<-rcorr(as.matrix(subset(EuropeOmnibus, select=c(DefSpread_lag1,
                                               EUldrSpread_lag1,
                                               NATOessSpread_lag1,
                                               EUcloserUSspread_lag1,
                                               NGDPPC_eu2014, 
                                               Population,
                                               Debt_NGDP,
                                               EUdebt_NGDP,
                                               SDfc_NGDP,
                                               Dfc_NGDP))))


corrdisp[[1]][,9:10]

BalanceScatter <- melt(EuropeOmnibus, measure.vars = c("SDfc_NGDP",
                                           "Dfc_NGDP"))

 
    ggplot(data=BalanceScatter,aes(x=value,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+
        facet_wrap(~variable)+geom_point()+stat_smooth(method = "lm", col = "green") 

    BalanceLine <- melt(EuropeOmnibus, measure.vars = c("NGDP_eu2014",
"SDfc_NGDP",
                                           "Dfc_NGDP",
                                           "DefSpend_lead"))

    BalanceLine$value[BalanceLine$variable %in% c("NGDP_eu2014","DefSpend_lead")]<-
        log(BalanceLine$value[BalanceLine$variable %in% c("NGDP_eu2014","DefSpend_lead")])
    ggplot(data=BalanceLine,aes(x=Year,
                            y=value,
                            color=variable))+geom_line()+facet_grid(variable~Country,scale="free_y")

    
        
reg<-7
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+SDfc_NGDP, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+SDfc_NGDP, EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+SDfc_NGDP, EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+SDfc_NGDP, EuropeEUcloserUS))
nModel[reg]<-"GGSB"
reg<-8
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP, EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP, EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP, EuropeEUcloserUS))
nModel[reg]<-"GGXCNL"


screenreg(c(lmMoreDef[c(6:8)],
               lmEUldr[c(6:8)]),
               custom.model.names=c(rep(nModel[c(6:8)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,9,3,4,5,6,7,8),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:9))
                        # , "Security"=6,, "Parliamentary"=8:11))



screenreg(c(lmNATOess[c(6:8)],
               lmEU_UScls[c(6:8)]),
               custom.model.names=c(rep(nModel[c(6:8)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,9,3,4,5,6,7,8),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:9))
                        # , "Security"=6,, "Parliamentary"=8:11))
              

```

GGXCNL, the country's actual balance sheet rather than the strucutural one, seems like the better fit of the two. The negatives for some of the variables contradict what you would expect from the literature and worse for GGSB. In those cases, it may be acting as a hidden variable reflecting the government's willingness to carry deficits. We are adding GGXCNL, as it better reflects the scatter plot and measures contained in the Treaty of Maastricht.



##Security Environment Controls
###Militarizied disputes and support for UN operations.
``` {r Conflict, echo = TRUE}

corrdisp<-rcorr(as.matrix(subset(EuropeOmnibus, select=c(DefSpread_lag1,
                                               EUldrSpread_lag1,
                                               NATOessSpread_lag1,
                                               EUcloserUSspread_lag1,
                                               NGDPPC_eu2014, 
                                               Population, 
                                               Debt_NGDP,
                                               EUdebt_NGDP,
                                               Dfc_NGDP,
                                               IntlCnf,
                                               UNmilitaryPMil))))

corrdisp[[1]][,10:11]

ConflictScatter <- melt(EuropeOmnibus, measure.vars = c("IntlCnf",
                                           "UNmilitaryPMil"))

 
    ggplot(data=ConflictScatter ,aes(x=value,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+
        facet_grid(~variable,scale="free_x")+geom_point()+stat_smooth(method = "lm", col = "green") 

    
reg<-9
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+
                            Dfc_NGDP+IntlCnf, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                          log(Population)+Debt_NGDP+EUdebt_NGDP+  
                          Dfc_NGDP+IntlCnf, EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+  
                            Dfc_NGDP+IntlCnf, EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                             log(Population)+Debt_NGDP+EUdebt_NGDP+   
                             Dfc_NGDP+IntlCnf, EuropeEUcloserUS))
nModel[reg]<-"IntlCnf"
reg<-10
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + 
                            log(NGDPPC_eu2014)+log(Population)+Debt_NGDP+
                            EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil,
                        EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + 
                          log(NGDPPC_eu2014)+log(Population)+
                          Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil,
                      EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil,
                        EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+
                             log(NGDPPC_eu2014)+log(Population)+
                             Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil,
                         EuropeEUcloserUS))
nModel[reg]<-"UNmil"


screenreg(c(lmMoreDef[c(6,9:10)],
               lmEUldr[c(6,9:10)]),
               custom.model.names=c(rep(nModel[c(7,9:10)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
                    reorder.coef=c(1,2,10,3,4,5,6,7,8,9),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:10))


screenreg(c(lmNATOess[c(6,9:10)],
               lmEU_UScls[c(6,9:10)]),
               custom.model.names=c(rep(nModel[c(7,9:10)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
                    reorder.coef=c(1,2,10,3,4,5,6,7,8,9),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:10))

subset(EuropeOmnibus,IntlCnf==1)[,1:2]


```

The direction of the UN troops + experts per million in population was surprising, as we had intuited that it may build support for spending. However, it appears to be a non-spurious results as it does align with the scatter plot and doesn't specifically contradict past literature. Leaving it in as it is significant in some cases. International conflict is actually a challenging variable as it's only true in 6 instances, 5 of which being Turkey. Participation in operations in Afghanistan does not qualify. Given the limited relevance and the risk that it's a dummy variable for Turkey, it will be left out.

On the other hand UN military, it does seem to lead to a Cook's distance violation for More Defense. We'll track that going forward.

###Terrorist Attacks
``` {r TerroristAttacks, echo = TRUE}

corrdisp<-rcorr(as.matrix(subset(EuropeOmnibus, select=c(DefSpread_lag1,
                                               EUldrSpread_lag1,
                                               NATOessSpread_lag1,
                                               EUcloserUSspread_lag1,
                                               NGDPPC_eu2014, 
                                               Population, 
                                               Debt_NGDP,
                                               EUdebt_NGDP,
                                               Dfc_NGDP,
                                               UNmilitaryPMil,
                                               DomAt,
                                               IntAt
                                               ))))

corrdisp[[1]][,11:12]

TerrorismScatter <- melt(EuropeOmnibus, measure.vars = c("DomAt",
                                           "IntAt"))

 
    ggplot(data=TerrorismScatter,aes(x=value,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+
        facet_grid(~variable,scale="free_x")+geom_point()+stat_smooth(method = "lm", col = "green") 

    
reg<-11
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+DomAt, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil +DomAt,
                      EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil +DomAt,
                        EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil +DomAt,
                         EuropeOmnibus))
nModel[reg]<-"DomAt"
reg<-12
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt, EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt, EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt,
                         EuropeEUcloserUS))
nModel[reg]<-"IntAt"


screenreg(c(lmMoreDef[c(10:12)],
               lmEUldr[c(10:12)]),
               custom.model.names=c(rep(nModel[c(10:12)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
        reorder.coef=c(1,2,11,3,4,5,6,7,8,9,10),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:11))
             



screenreg(c(lmNATOess[c(10:12)],
               lmEU_UScls[c(10:12)]),
               custom.model.names=c(rep(nModel[c(10:12)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
        reorder.coef=c(1,2,11,3,4,5,6,7,8,9,10),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:11))
   

subset(EuropeOmnibus,DomAt==1)[,1:2]

subset(EuropeOmnibus,IntAt==1)[,1:2]


```

Domestic terrorism is more associated with security forces, so it isn't necessarily unusual that there's a slight negative here, but that's weak and contradicts the scatter plot, so we'll leave it out. International terrorism has the expected relationship that is in line with the scatter plot and is reliably significant, so we'll add it.

Note that Cook's distance violation for More Defense is now just within the boundary. Normal Q-Q has been slowly evening out its ends for most of the models, although it still skews some for EU-US closeness.

###Global Conflict Levels
```{r GlobalCivilWars}



corrdisp<-rcorr(as.matrix(subset(EuropeOmnibus, select=c(DefSpread_lag1,
                                               EUldrSpread_lag1,
                                               NATOessSpread_lag1,
                                               EUcloserUSspread_lag1,
                                               NGDPPC_eu2014, 
                                               Population, 
                                               Debt_NGDP,
                                               EUdebt_NGDP,
                                               Dfc_NGDP,
                                               UNmilitaryPMil,
                                               IntAt,
                                               GCivilWarBRDDelt
                                               ))))

corrdisp[[1]][,12]


    ggplot(data=EuropeOmnibus,aes(x=GCivilWarBRDDelt,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+stat_smooth(method = "lm", col = "green") 


    

    
reg<-13
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt+
                            log(GCivilWarBRD),
                        EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt+
                            log(GCivilWarBRD),
                      EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt+
                            log(GCivilWarBRD), 
                        EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt+
                            log(GCivilWarBRD),
                         EuropeEUcloserUS))
nModel[reg]<-"gCivilWarBRD"


# screenreg(c(lmMoreDef[c(12,14:15)],
#                lmEUldr[c(12,14:15)],
#                lmNATOess[c(12,14:15)],
#                lmEU_UScls[c(12,14:15)]),
#                custom.model.names=c(rep(nModel[c(12,14:15)],4)))


screenreg(c(lmMoreDef[c(12:13)],
            lmEUldr[c(12:13)],
            lmNATOess[c(12:13)],
            lmEU_UScls[c(12:13)]),
          custom.model.names=c(rep(nModel[c(12:13)],4)),
              stars=c(0.001,0.01,0.05,0.1),
        reorder.coef=c(1,2,11,12,13,3,4,5,6,7,8,9,10),
          groups = list("Intercept" = 1,"Polling" = 2:5,"Macroeconomic" = 6:9,"Security"=10:13))
   

```

Global Civil Wars do not appear to be significant, but they do increase the significance of NATO being essential. Leaving it in.

##Parliamentary Opinion Controls

###Cabinet Left/Right vs. Liberty/Security
``` {r LeftRightvsLibertyAuthortiy, echo = TRUE}

corrdisp<-rcorr(as.matrix(subset(EuropeOmnibus, select=c(DefSpread_lag1,
                                               EUldrSpread_lag1,
                                               NATOessSpread_lag1,
                                               EUcloserUSspread_lag1,
                                               NGDPPC_eu2014, 
                                               Population, 
                                               Debt_NGDP,
                                               EUdebt_NGDP,
                                               Dfc_NGDP,
                                               UNmilitaryPMil,
                                               IntAt,
                                               GCivilWarBRDDelt,
                                               Cab_left_right,
                                               Cab_liberty_authority,
                                               Cab_eu_anti_pro,
                                               left_right_ls_spread,
                                               liberty_authority_ls_spread,
                                               eu_anti_pro_ls_spread
                                               ))))

corrdisp[[1]][,13:15]
corrdisp[[1]][,16:18]


LeftRightVsLibAuthScatter <- melt(EuropeOmnibus, measure.vars = c("Cab_left_right",
                                           "left_right_ls_spread",
                                           "Cab_liberty_authority",
                                           "liberty_authority_ls_spread"))
LeftRightVsLibAuthScatter$Measure<-NA
LeftRightVsLibAuthScatter$Measure[LeftRightVsLibAuthScatter$variable %in%  
                          c("Cab_left_right","Cab_liberty_authority")]<-"Cabinet"
LeftRightVsLibAuthScatter$Measure[is.na(LeftRightVsLibAuthScatter$Measure)]<-"Polarization"
LeftRightVsLibAuthScatter$Score<-NA
LeftRightVsLibAuthScatter$Score[LeftRightVsLibAuthScatter$variable %in% 
                          c("Cab_left_right","left_right_ls_spread")]<-"Left/Right"
LeftRightVsLibAuthScatter$Score[is.na(LeftRightVsLibAuthScatter$Score)]<-"Lib/Auth"


    ggplot(data=LeftRightVsLibAuthScatter,aes(x=value,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+
        facet_grid(Score~Measure , scales="free_x")+stat_smooth(method = "lm", col = "green") 

    
reg<-14
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt+
                            log(GCivilWarBRD)+
                          Cab_left_right+left_right_ls_spread, EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil +IntAt+
                          log(GCivilWarBRD)+
                          Cab_left_right+left_right_ls_spread,
                      EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil +IntAt+
                            log(GCivilWarBRD)+
                          Cab_left_right+left_right_ls_spread,
                        EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil +IntAt+
                             log(GCivilWarBRD)+
                          Cab_left_right+left_right_ls_spread,
                         EuropeEUcloserUS))
nModel[reg]<-"LefRgh"
reg<-15
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt+
                            log(GCivilWarBRD)+
                            Cab_liberty_authority+liberty_authority_ls_spread,
                        EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt+
                          log(GCivilWarBRD)+
                            Cab_liberty_authority+liberty_authority_ls_spread,
                      EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+UNmilitaryPMil+IntAt+
                            log(GCivilWarBRD)+
                            Cab_liberty_authority+liberty_authority_ls_spread, 
                        EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                             log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread,
                         EuropeEUcloserUS))
nModel[reg]<-"LibAuth"


# screenreg(c(lmMoreDef[c(10:13)],
#                lmEUldr[c(10:13)],
#                lmNATOess[c(10:13)],
#                lmEU_UScls[c(10:13)]),
#                custom.model.names=c(rep(nModel[c(10:13)],4)))

screenreg(c(lmMoreDef[c(13:15)],
               lmEUldr[c(13:15)]),
               custom.model.names=c(rep(nModel[c(13:15)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,15,3,4,5,6,7,8,9,10,11,12,13,14),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:11,"Parliamentary"=12:15))



screenreg(c(lmNATOess[c(13:15)],
               lmEU_UScls[c(13:15)]),
               custom.model.names=c(rep(nModel[c(13:15)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,15,3,4,5,6,7,8,9,10,11,12,13,14),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:11,"Parliamentary"=12:15))



```

Left/Right and Liberty/Authority are correlated, so we'll only use one of the two. In this case, both are somewhat tempting and significant with E.U.-U.S. closeness, but between the cabinet and polarization measures, liberty/authority reliably is significant and offers a lower RMSE. One oddity, the scatterplots are not as helpful in this instance, likely because they are dominated by fixed effects. Cabinets are fairly static and so each country tends to be at a consistent place in the list. The variables shake out as one would expect when it comes to regression, however. 
Note that inclusion of Cabinet Liberty/Authority means that EU leadership is no longer has a significant affect on defense spending, while that is not true for the left/right scale. However, liberty/authority polorization is significant and the RMSE declined, which suggests that polorization may better explain defense spending than opinions of EU leadership.

###Parliament Anti/Pro European Union

```{r EUantiProAlone}
EUantiProScatter <- melt(EuropeOmnibus, measure.vars = c("Cab_eu_anti_pro",
                                                         "eu_anti_pro_ls_spread"))

    ggplot(data=EUantiProScatter,aes(x=value,
                            y=DefSpendDelt_lead,
                            color=Country))+geom_point()+
        facet_grid(~variable , scales="free_x")+stat_smooth(method = "lm", col = "green") 



reg<-16
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                            UNmilitaryPMil+IntAt+  log(GCivilWarBRD)+
                            Cab_eu_anti_pro+eu_anti_pro_ls_spread,
                        EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                          log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                          UNmilitaryPMil+IntAt+  log(GCivilWarBRD)+
                          Cab_eu_anti_pro+eu_anti_pro_ls_spread,
                      EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                            UNmilitaryPMil+IntAt+  log(GCivilWarBRD)+
                            Cab_eu_anti_pro+eu_anti_pro_ls_spread, 
                        EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                             log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+  log(GCivilWarBRD)+
                             Cab_eu_anti_pro+eu_anti_pro_ls_spread,
                         EuropeEUcloserUS))
nModel[reg]<-"EUantiPro"


# screenreg(c(lmMoreDef[c(10:13)],
#                lmEUldr[c(10:13)],
#                lmNATOess[c(10:13)],
#                lmEU_UScls[c(10:13)]),
#                custom.model.names=c(rep(nModel[c(10:13)],4)))

screenreg(c(lmMoreDef[c(15:16)],
               lmEUldr[c(15:16)]),
               custom.model.names=c(rep(nModel[c(15:16)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,15,3,4,5,6,7,8,9,10,11,12,13,14),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:11,"Parliamentary"=12:15))




screenreg(c(lmNATOess[c(15:16)],
               lmEU_UScls[c(15:16)]),
               custom.model.names=c(rep(nModel[c(15:16)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,15,3,4,5,6,7,8,9,10,11,12,13,14),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:11,"Parliamentary"=12:15))


```

 We also consider EU-anti-pro in isolation and liberty/authority does show more significance and has stronger textual support. That said, in the next section we consider it in combination with liberty/authority.

``` {r EUantiProTogether, echo = TRUE}

reg<-17
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro,
                        EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro,
                      EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro, 
                        EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro,
                         EuropeEUcloserUS))
nModel[reg]<-"EUantiPro1"
reg<-18
lmMoreDef[reg]<-list(lm(log(DefSpend_lead) ~ DefSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro+eu_anti_pro_ls_spread,
                        EuropeMoreDef))
lmEUldr[reg]<-list(lm(log(DefSpend_lead) ~ EUldrSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro+eu_anti_pro_ls_spread,
                      EuropeEUleadership))
lmNATOess[reg]<-list(lm(log(DefSpend_lead) ~ NATOessSpread_lag1 + log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro+eu_anti_pro_ls_spread, 
                        EuropeNATOess))
lmEU_UScls[reg]<-list(lm(log(DefSpend_lead) ~ EUcloserUSspread_lag1+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro+eu_anti_pro_ls_spread,
                         EuropeEUcloserUS))
nModel[reg]<-"EUantiPro2"




# screenreg(c(lmMoreDef[c(12,14:15)],
#                lmEUldr[c(12,14:15)],
#                lmNATOess[c(12,14:15)],
#                lmEU_UScls[c(12,14:15)]),
#                custom.model.names=c(rep(nModel[c(12,14:15)],4)))

screenreg(c(lmMoreDef[c(15,17:18)],
               lmEUldr[c(15,17:18)]),
               custom.model.names=c(rep(nModel[c(15,17:18)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
           reorder.coef=c(1,2,15,3,4,5,6,7,8,9,10,11,12,13,14),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:11,"Parliamentary"=12:15))

screenreg(c(lmNATOess[c(15,17:18)],
               lmEU_UScls[c(15,17:18)]),
               custom.model.names=c(rep(nModel[c(15,17:18)],2)),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,2,15,3,4,5,6,7,8,9,10,11,12,13,14),
          groups = list("Intercept" = 1,"Polling" = 2:3,"Macroeconomic" = 4:8,"Security"=9:11,"Parliamentary"=12:15))


```

Pro/Anti EU attitudes do reach significance in two cases and appear to be more significant when the cabinet polorization on the issue is not included. 




#Adjusting for Panel Data
##Displaying the selected Ordinary Least Squares model.
``` {r PanelModelPreparation, echo = TRUE}

panelmodels<-function(selected.formula,
                      source.data,
                      regression.name,
                      dependent.name=NA,
                      independent.name=NA,
                      include.random=TRUE){
    
    model.df<-data.frame(name=regression.name,
                         dependent.name=dependent.name,
                         independent.name=independent.name,
                         ols=I(list(lm(as.formula(selected.formula), 
                                       data = source.data))),
                         fixed=I(list(plm(as.formula(selected.formula),
                                          data = source.data,
                                          model = "within"))),
                         fixed.time=I(list(plm(as.formula(paste(selected.formula,"+ factor(Year)")), 
                                               data =  source.data,
                                               model = "within"))),
                         random=I(ifelse(include.random,
                                         list(plm(as.formula(selected.formula), 
                                                  data =  source.data,
                                                  model = "random")),
                                         NA))
                         
    )
    
    model.df
}
```

```{r TimeEffectProxyVariables}

SelectedControlsWithTimeProxy<-"+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+EUdebt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+log(GCivilWarBRD)+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro"



#Model 1: Total Defense and More/Less Defense Spending 
ModelPicking<-panelmodels(selected.formula=paste("log(DefSpend_lead) ~ DefSpread_lag1",SelectedControlsWithTimeProxy),
                          source.data=EuropeMoreDef,
                          regression.name="Too Much/Little Def. Spending & Total Defense",
                          dependent.name="Total Defense",
                          independent.name="Defense More/Less",
                          include.random=FALSE)

#Model 2: Total Defense and EU Leadership
ModelPicking<-rbind(
    ModelPicking[1,],
    panelmodels(selected.formula=paste("log(DefSpend_lead) ~ EUldrSpread_lag1",SelectedControlsWithTimeProxy),
                source.data=EuropeEUleadership,
                regression.name="EU Leadership & Total Defense",
                dependent.name="Total Defense",
                independent.name="EU Leadership",
                include.random=TRUE)
)

#Model 3: Total Defense and NATO Essential
ModelPicking<-rbind(
    ModelPicking[1:2,],
    panelmodels(selected.formula=paste("log(DefSpend_lead) ~ NATOessSpread_lag1",SelectedControlsWithTimeProxy),
                source.data=EuropeNATOess,
                regression.name="NATO Essential & Total Defense",
                dependent.name="Total Defense",
                independent.name="NATO Essential",
                include.random=TRUE)
)


#Model 4: Total Defense and EU closer to US
ModelPicking<-rbind(
    ModelPicking[1:3,],
    panelmodels(selected.formula=paste("log(DefSpend_lead) ~ EUcloserUSspread_lag1",SelectedControlsWithTimeProxy),
                source.data=EuropeEUcloserUS,
                regression.name="EU closer to US & Total Defense",
                dependent.name="Total Defense",
                independent.name="EU closer to US",
                include.random=FALSE)
)

screenreg(c(ModelPicking$ols[1:4]),
               custom.model.names=as.character(ModelPicking$independent.name[1:4]),
                 stars=c(0.001,0.01,0.05,0.1),
         reorder.coef=c(1,2,14,15,16,3,4,5,6,7,8,9,10,11,12,13),
          groups = list("Intercept" = 1,"Polling" = 2:5,"Macroeconomic" = 6:10,"Security"=11:13,"Parliamentary"=14:16))


```




```{r Fixed}

summary(ModelPicking$fixed[[1]])
summary(ModelPicking$fixed[[2]])
summary(ModelPicking$fixed[[3]])
summary(ModelPicking$fixed[[4]])



##hausman test for fixed versus random effects model:compares how close the coefficients of the model are:
phtest(ModelPicking$fixed[[2]],ModelPicking$random[[2]])
phtest(ModelPicking$fixed[[3]],ModelPicking$random[[3]])

```

The Hausman text indicates using fixed effects for the two models for which Random Effects alternatives are available.  "EU leadership" (model 2) and "Nato Essential" (model 3). Thus, no random effects models will be used.

```{r AlternateWithDummyVariables}

SelectedControlsWithTimeProxy<-"+ log(NGDPPC_eu2014)+
                            log(Population)+Debt_NGDP+Dfc_NGDP+
                             UNmilitaryPMil+IntAt+
                             Cab_liberty_authority+liberty_authority_ls_spread+
                            Cab_eu_anti_pro"



#Model Alt1: Total Defense and More/Less Defense Spending 
AltEuropeMode<-panelmodels(selected.formula=paste("log(DefSpend_lead) ~ DefSpread_lag1",SelectedControlsWithTimeProxy),
                          source.data=EuropeMoreDef,
                          regression.name="Too Much/Little Def. Spending & Total Defense",
                          dependent.name="Total Defense",
                          independent.name="Defense More/Less",
                          include.random=FALSE)


#Model Alt2: Total Defense and EU Leadership
AltEuropeMode<-rbind(
    AltEuropeMode[1,],
    panelmodels(selected.formula=paste("log(DefSpend_lead) ~ EUldrSpread_lag1",SelectedControlsWithTimeProxy),
                source.data=EuropeEUleadership,
                regression.name="EU Leadership & Total Defense",
                dependent.name="Total Defense",
                independent.name="EU Leadership",
                include.random=FALSE)
)

#Model Alt3: Total Defense and NATO Essential
AltEuropeMode<-rbind(
    AltEuropeMode[1:2,],
    panelmodels(selected.formula=paste("log(DefSpend_lead) ~ NATOessSpread_lag1",SelectedControlsWithTimeProxy),
                source.data=EuropeNATOess,
                regression.name="NATO Essential & Total Defense",
                dependent.name="Total Defense",
                independent.name="NATO Essential",
                include.random=TRUE)
)


#Model Alt4: Total Defense and EU closer to US
AltEuropeMode<-rbind(
    AltEuropeMode[1:3,],
    panelmodels(selected.formula=paste("log(DefSpend_lead) ~ EUcloserUSspread_lag1",SelectedControlsWithTimeProxy),
                source.data=EuropeEUcloserUS,
                regression.name="EU closer to US & Total Defense",
                dependent.name="Total Defense",
                independent.name="EU closer to US",
                include.random=FALSE)
)

pFtest(summary(AltEuropeMode$fixed.time[[1]]), summary(AltEuropeMode$fixed[[1]]))
pFtest(summary(AltEuropeMode$fixed.time[[2]]), summary(AltEuropeMode$fixed[[2]]))
pFtest(summary(AltEuropeMode$fixed.time[[3]]), summary(AltEuropeMode$fixed[[3]]))
pFtest(summary(AltEuropeMode$fixed.time[[4]]), summary(AltEuropeMode$fixed[[4]]))


screenreg(c(AltEuropeMode$fixed.time[1:4]),
               custom.model.names=as.character(AltEuropeMode$independent.name[1:4]),
                 stars=c(0.001,0.01,0.05,0.1),
          reorder.coef=c(1,16,22,23,2,
                         3,4,5,6,7,
                         8,9,10,11,12,
                         17,18,19,13,20,
                         21,14,15),
          groups = list("Polling" = 1:4,"Macroeconomic" = 5:8,"Security"=9:10,
                        "Parliamentary"=11:13,"Temporal"=14:23))


    
```

Notably, the dummy fiscal year variables for model 1 are not significant. This aligns with the pFtest (as interpretted by http://www.princeton.edu/~otorres/Panel101R.pdf pg. 18). 

Thus, sticking with the fixed model with global civil war deaths and European debt levels as the 

##Final Model
```{r FinalModel}

screenreg(c(ModelPicking$fixed[1:4]),
               custom.model.names=as.character(ModelPicking$independent.name[1:4]),
                 stars=c(0.001,0.01,0.05,0.1),
         reorder.coef=c(1,13,14,15,2,3,4,5,6,7,8,9,10,11,12),
          groups = list("Polling" = 1:4,"Macroeconomic" = 5:9,"Security"=10:12,"Parliamentary"=13:15))

```